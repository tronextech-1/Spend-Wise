<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <!-- 
    Adjust CSP as needed. This is a basic example.
    For Cordova, 'gap:' might be needed by some plugins on older platforms for iframe communication.
    'filesystem:' for cordova-plugin-file urls.
  -->
    <meta http-response-equiv="Content-Security-Policy" content="default-src 'self' data: blob: filesystem: gap: https://flagcdn.com; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdnjs.cloudflare.com; connect-src *; img-src 'self' data: blob: filesystem: https://flagcdn.com;">
    <title>Spend Wise - Expense Manager</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            box-sizing: border-box;
        }
    </style>
    <style>
         :root {
            --font-family-system: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            /* Light Theme (Default) */
            --body-bg: #f0f2f5;
            --body-text-color: #333;
            --header-bg-gradient-start: #34a83a;
            /* Enhanced */
            --header-bg-gradient-end: #288c2d;
            /* Enhanced */
            --header-text-color: white;
            --header-icon-btn-bg: rgba(255, 255, 255, 0.15);
            --header-icon-btn-bg-hover: rgba(255, 255, 255, 0.25);
            --header-icon-btn-bg-active: rgba(255, 255, 255, 0.35);
            --header-org-name-bg: rgba(255, 255, 255, 0.1);
            --org-setup-bg-gradient-start: #3a9d40;
            --org-setup-bg-gradient-end: #256b2a;
            --org-setup-text-color: white;
            --org-setup-card-bg: rgba(255, 255, 255, 0.15);
            --org-setup-card-border: rgba(255, 255, 255, 0.2);
            --org-setup-icon-bg: #FFD700;
            --org-setup-icon-text: #B8860B;
            --form-input-bg: rgba(255, 255, 255, 0.9);
            --form-input-text: #1b5e20;
            /* Specific to org-setup */
            --form-input-placeholder: #668c68;
            /* Specific to org-setup */
            --form-input-focus-border: #4caf50;
            --form-input-focus-bg: #fff;
            --form-input-focus-shadow: rgba(76, 175, 80, 0.3);
            --form-input-error-border: #ef4444;
            --form-input-error-shadow: rgba(239, 68, 68, 0.4);
            --action-button-bg: #4caf50;
            /* Green action button */
            --action-button-text: white;
            --action-button-hover-bg: #5cb85c;
            --action-button-active-bg: #3e8e41;
            --action-button-secondary-bg: #5a6268;
            --action-button-secondary-hover-bg: #484f55;
            --action-button-disabled-bg: #9ca3af;
            --general-input-bg: #fff;
            --general-input-text: #333;
            --general-input-border: #d1d5db;
            --general-input-placeholder: #6b7280;
            /* General placeholder */
            --general-input-focus-border: #2563eb;
            --general-input-focus-shadow: rgba(37, 99, 235, 0.2);
            --button-default-bg: #2e7d32;
            --button-default-text: white;
            --button-default-hover-bg: #1b5e20;
            --button-default-active-bg: #123d14;
            --button-disabled-bg: #9ca3af;
            --button-view-tx-bg: #1e40af;
            --button-view-tx-hover-bg: #1c357a;
            --button-edit-bg: #1e40af;
            /* Similar to view tx */
            --button-edit-hover-bg: #1c357a;
            --button-delete-bg: #ef4444;
            --button-delete-hover-bg: #dc2626;
            --button-delete-disabled-bg: #f8b4b4;
            --button-voice-bg: #3b82f6;
            --button-voice-hover-bg: #2563eb;
            --button-voice-active-bg: #1d4ed8;
            --button-export-bg: #4b5563;
            --button-export-hover-bg: #374151;
            --button-tx-type-receive-bg: #22c55e;
            --button-tx-type-receive-active-bg: #16a34a;
            --button-tx-type-send-bg: #ef4444;
            --button-tx-type-send-active-bg: #dc2626;
            --button-delete-all-bg: #b91c1c;
            /* Darker red for delete all */
            --button-delete-all-hover-bg: #991b1b;
            --balance-box-bg: #ffffff;
            --balance-box-border: #e5e7eb;
            --balance-box-shadow: rgba(0, 0, 0, 0.05);
            --balance-label-color: #374151;
            --balance-in-text-strong: #166534;
            --balance-out-text-strong: #991b1b;
            --balance-net-text-strong: #1e40af;
            --balance-in-value-color: #22c55e;
            --balance-out-value-color: #ef4444;
            --balance-net-value-color: #3b82f6;
            --lang-selector-bg: #fff;
            --lang-selector-border: #d1d5db;
            --lang-selector-hover-bg: #f9fafb;
            --lang-selector-hover-border: #adb5bd;
            --lang-dropdown-bg: white;
            --lang-dropdown-border: #e5e7eb;
            --lang-dropdown-shadow: rgba(0, 0, 0, 0.1);
            --lang-option-hover-bg: #f3f4f6;
            --lang-option-active-bg: #e9ecef;
            --lang-option-active-text: #2e7d32;
            /* Custom Select (Sort Dropdown) */
            --custom-select-bg: var(--general-input-bg);
            --custom-select-text: var(--general-input-text);
            --custom-select-border: var(--general-input-border);
            --custom-select-hover-bg: var(--lang-selector-hover-bg);
            /* Use lang selector for consistency */
            --custom-select-hover-border: var(--lang-selector-hover-border);
            --custom-select-dropdown-bg: var(--lang-dropdown-bg);
            --custom-select-dropdown-border: var(--lang-dropdown-border);
            --custom-select-dropdown-shadow: var(--lang-dropdown-shadow);
            --custom-select-option-hover-bg: var(--lang-option-hover-bg);
            --custom-select-option-active-bg: var(--lang-option-active-bg);
            --custom-select-option-active-text: var(--lang-option-active-text);
            --custom-select-arrow-color: var(--general-input-placeholder);
            --tx-page-bg: white;
            --tx-controls-bg: #f9fafb;
            --tx-controls-border: #e5e7eb;
            --tx-list-wrapper-bg: #fff;
            --tx-item-border: #e5e7eb;
            --tx-item-hover-bg: #f8f9fa;
            --tx-desc-color: #1f2937;
            --tx-meta-color: #6b7280;
            --tx-type-in-color: #16a34a;
            --tx-type-out-color: #ef4444;
            --tx-amount-color: #1f2937;
            --tx-filter-btn-bg: #e5e7eb;
            --tx-filter-btn-text: #374151;
            --tx-filter-btn-hover-bg: #d1d5db;
            --tx-filter-btn-active-bg: #2e7d32;
            --tx-filter-btn-active-text: white;
            --no-tx-text-color: #6b7280;
            --message-bg: #ffeb3b;
            --message-text-color: #333;
            --message-error-bg: #f87171;
            --message-error-text-color: white;
            --message-success-bg: #4ade80;
            --message-success-text-color: #052e16;
            --message-info-bg: #3b82f6;
            /* For info messages like "Offline" */
            --message-info-text-color: white;
            --message-shadow: rgba(0, 0, 0, 0.15);
            --modal-overlay-bg: rgba(0, 0, 0, 0.6);
            --modal-content-bg: white;
            --modal-content-shadow: rgba(0, 0, 0, 0.15);
            --modal-title-color: #222;
            --modal-text-color: #555;
            --modal-input-label-color: #444;
            /* For Edit Modal */
            --modal-cancel-btn-bg: #6c757d;
            --modal-cancel-btn-hover-bg: #5a6268;
            --modal-confirm-btn-bg: #dc3545;
            /* Default confirm (like delete) */
            --modal-confirm-btn-hover-bg: #c82333;
            --modal-save-btn-bg: var(--button-default-bg);
            /* For Save in Edit Modal */
            --modal-save-btn-hover-bg: var(--button-default-hover-bg);
            --modal-info-confirm-btn-bg: #0d6efd;
            /* For general info modals if needed */
            --modal-info-confirm-btn-hover-bg: #0b5ed7;
            --modal-close-btn-bg: var(--button-default-bg);
            /* For User Manual close */
            --modal-close-btn-hover-bg: var(--button-default-hover-bg);
            --welcome-overlay-bg: rgba(0, 0, 0, 0.65);
            --welcome-box-bg: white;
            --welcome-box-shadow: rgba(0, 0, 0, 0.2);
            --welcome-title-color: #2e7d32;
            --welcome-text-color: #454545;
            --welcome-button-bg: #2e7d32;
            --welcome-button-text-color: white;
            --welcome-button-hover-bg: #1b5e20;
            --input-border-radius: 10px;
            /* For input group consistency */
            /* Image Preview Page */
            --image-preview-bg: var(--body-bg);
            --image-preview-header-bg: var(--header-bg-gradient-start);
            --image-preview-text-color: var(--body-text-color);
            --image-preview-image-border: #ccc;
            --image-preview-image-shadow: rgba(0, 0, 0, 0.1);
            --image-preview-nav-btn-bg: var(--button-default-bg);
            --image-preview-nav-btn-hover-bg: var(--button-default-hover-bg);
            /* Offline Page */
            --offline-page-bg: var(--body-bg);
            /* Use body-bg for consistency */
            --offline-page-text-color: var(--body-text-color);
            --offline-page-icon-color: #999;
            --offline-page-title-color: var(--header-bg-gradient-start);
            /* Side Menu */
            --side-menu-bg: #fff;
            --side-menu-text-color: #333;
            --side-menu-border-color: #e0e0e0;
            --side-menu-item-hover-bg: #f5f5f5;
            --side-menu-item-icon-color: #555;
            --side-menu-overlay-bg: rgba(0, 0, 0, 0.5);
        }
        
        body.theme-dark {
            --body-bg: #121212;
            --body-text-color: #e0e0e0;
            --header-bg-gradient-start: #264a27;
            --header-bg-gradient-end: #1a3a1b;
            --header-text-color: #e0e0e0;
            --header-icon-btn-bg: rgba(255, 255, 255, 0.1);
            --header-icon-btn-bg-hover: rgba(255, 255, 255, 0.18);
            --header-icon-btn-bg-active: rgba(255, 255, 255, 0.25);
            --header-org-name-bg: rgba(255, 255, 255, 0.08);
            --org-setup-bg-gradient-start: #224b25;
            --org-setup-bg-gradient-end: #173319;
            --org-setup-text-color: #e0e0e0;
            --org-setup-card-bg: rgba(255, 255, 255, 0.08);
            --org-setup-card-border: rgba(255, 255, 255, 0.15);
            --form-input-bg: rgba(255, 255, 255, 0.1);
            --form-input-text: #c8e6c9;
            --form-input-placeholder: #708d72;
            --form-input-focus-border: #66bb6a;
            --form-input-focus-bg: rgba(255, 255, 255, 0.15);
            --form-input-focus-shadow: rgba(102, 187, 106, 0.3);
            --form-input-error-border: #ef5350;
            --form-input-error-shadow: rgba(239, 83, 80, 0.4);
            --action-button-bg: #388e3c;
            --action-button-hover-bg: #4caf50;
            --action-button-active-bg: #2e7d32;
            --action-button-secondary-bg: #424242;
            --action-button-secondary-hover-bg: #616161;
            --action-button-disabled-bg: #555;
            --general-input-bg: #2a2a2a;
            --general-input-text: #e0e0e0;
            --general-input-border: #444;
            --general-input-placeholder: #888;
            --general-input-focus-border: #42a5f5;
            --general-input-focus-shadow: rgba(66, 165, 245, 0.3);
            --button-default-bg: #388e3c;
            --button-default-hover-bg: #4caf50;
            --button-default-active-bg: #2e7d32;
            --button-disabled-bg: #555;
            --button-view-tx-bg: #1976d2;
            --button-view-tx-hover-bg: #2196f3;
            --button-edit-bg: #1976d2;
            --button-edit-hover-bg: #2196f3;
            --button-delete-bg: #d32f2f;
            --button-delete-hover-bg: #f44336;
            --button-delete-disabled-bg: #7f1d1d;
            --button-voice-bg: #1e88e5;
            --button-voice-hover-bg: #42a5f5;
            --button-voice-active-bg: #1565c0;
            --button-export-bg: #616161;
            --button-export-hover-bg: #757575;
            --button-tx-type-receive-bg: #388e3c;
            --button-tx-type-receive-active-bg: #4caf50;
            --button-tx-type-send-bg: #d32f2f;
            --button-tx-type-send-active-bg: #f44336;
            --button-delete-all-bg: #a01010;
            /* Darker red for delete all - dark theme */
            --button-delete-all-hover-bg: #7f0000;
            --balance-box-bg: #1e1e1e;
            --balance-box-border: #333;
            --balance-box-shadow: rgba(0, 0, 0, 0.2);
            --balance-label-color: #aaa;
            --balance-in-text-strong: #4caf50;
            --balance-out-text-strong: #f44336;
            --balance-net-text-strong: #2196f3;
            --balance-in-value-color: #66bb6a;
            --balance-out-value-color: #ef5350;
            --balance-net-value-color: #42a5f5;
            --lang-selector-bg: #2a2a2a;
            --lang-selector-border: #444;
            --lang-selector-hover-bg: #333;
            --lang-selector-hover-border: #555;
            --lang-dropdown-bg: #2a2a2a;
            --lang-dropdown-border: #444;
            --lang-dropdown-shadow: rgba(0, 0, 0, 0.3);
            --lang-option-hover-bg: #333;
            --lang-option-active-bg: #1e1e1e;
            --lang-option-active-text: #66bb6a;
            --custom-select-bg: var(--general-input-bg);
            --custom-select-text: var(--general-input-text);
            --custom-select-border: var(--general-input-border);
            --custom-select-hover-bg: var(--lang-selector-hover-bg);
            --custom-select-hover-border: var(--lang-selector-hover-border);
            --custom-select-dropdown-bg: var(--lang-dropdown-bg);
            --custom-select-dropdown-border: var(--lang-dropdown-border);
            --custom-select-dropdown-shadow: var(--lang-dropdown-shadow);
            --custom-select-option-hover-bg: var(--lang-option-hover-bg);
            --custom-select-option-active-bg: var(--lang-option-active-bg);
            --custom-select-option-active-text: var(--lang-option-active-text);
            --custom-select-arrow-color: var(--general-input-placeholder);
            --tx-page-bg: #1a1a1a;
            --tx-controls-bg: #212121;
            --tx-controls-border: #333;
            --tx-list-wrapper-bg: #1a1a1a;
            --tx-item-border: #333;
            --tx-item-hover-bg: #262626;
            --tx-desc-color: #e0e0e0;
            --tx-meta-color: #888;
            --tx-type-in-color: #66bb6a;
            --tx-type-out-color: #ef5350;
            --tx-amount-color: #e0e0e0;
            --tx-filter-btn-bg: #424242;
            --tx-filter-btn-text: #e0e0e0;
            --tx-filter-btn-hover-bg: #616161;
            --tx-filter-btn-active-bg: #388e3c;
            --tx-filter-btn-active-text: white;
            --no-tx-text-color: #888;
            --message-bg: #424242;
            --message-text-color: #e0e0e0;
            --message-error-bg: #b71c1c;
            --message-error-text-color: white;
            --message-success-bg: #1b5e20;
            --message-success-text-color: #c8e6c9;
            --message-info-bg: #1e88e5;
            /* Dark theme info messages */
            --message-info-text-color: white;
            --message-shadow: rgba(0, 0, 0, 0.25);
            --modal-overlay-bg: rgba(0, 0, 0, 0.8);
            --modal-content-bg: #2a2a2a;
            --modal-content-shadow: rgba(0, 0, 0, 0.25);
            --modal-title-color: #e0e0e0;
            --modal-text-color: #bbb;
            --modal-input-label-color: #ccc;
            --modal-cancel-btn-bg: #555;
            --modal-cancel-btn-hover-bg: #666;
            --modal-confirm-btn-bg: #c62828;
            --modal-confirm-btn-hover-bg: #d32f2f;
            --modal-save-btn-bg: var(--button-default-bg);
            --modal-save-btn-hover-bg: var(--button-default-hover-bg);
            --modal-info-confirm-btn-bg: #1565c0;
            --modal-info-confirm-btn-hover-bg: #1976d2;
            --modal-close-btn-bg: var(--button-default-bg);
            --modal-close-btn-hover-bg: var(--button-default-hover-bg);
            --welcome-overlay-bg: rgba(0, 0, 0, 0.8);
            --welcome-box-bg: #2a2a2a;
            --welcome-box-shadow: rgba(0, 0, 0, 0.3);
            --welcome-title-color: #66bb6a;
            --welcome-text-color: #bbb;
            --welcome-button-bg: #388e3c;
            --welcome-button-text-color: white;
            --welcome-button-hover-bg: #4caf50;
            --image-preview-bg: var(--body-bg);
            --image-preview-header-bg: var(--header-bg-gradient-start);
            --image-preview-text-color: var(--body-text-color);
            --image-preview-image-border: #555;
            --image-preview-image-shadow: rgba(0, 0, 0, 0.2);
            --image-preview-nav-btn-bg: var(--button-default-bg);
            --image-preview-nav-btn-hover-bg: var(--button-default-hover-bg);
            /* Offline Page - Dark */
            --offline-page-bg: var(--body-bg);
            --offline-page-text-color: var(--body-text-color);
            --offline-page-icon-color: #666;
            --offline-page-title-color: var(--header-bg-gradient-start);
            /* Side Menu Dark */
            --side-menu-bg: #2a2a2a;
            --side-menu-text-color: #e0e0e0;
            --side-menu-border-color: #444;
            --side-menu-item-hover-bg: #333;
            --side-menu-item-icon-color: #bbb;
        }
        /* --- Floating Action Button (Calculator) --- */
        
        .fab-calculator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background-color: var(--button-default-bg);
            color: var(--button-default-text);
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 999;
            transition: all 0.2s ease-in-out;
        }
        
        .fab-calculator:hover {
            background-color: var(--button-default-hover-bg);
            transform: translateY(-2px);
        }
        
        .fab-calculator .icon {
            font-size: 1.6rem;
        }
        /* --- Calculator Modal --- */
        
        .calculator-modal-content {
            padding: 15px !important;
            max-width: 320px !important;
            background: var(--body-bg) !important;
        }
        
        .calculator-display {
            background: var(--general-input-bg);
            color: var(--general-input-text);
            border: 1px solid var(--general-input-border);
            border-radius: var(--input-border-radius);
            padding: 15px;
            text-align: right;
            font-size: 2.2rem;
            font-weight: 300;
            margin-bottom: 15px;
            min-height: 70px;
            box-sizing: border-box;
            word-wrap: break-word;
            word-break: break-all;
        }
        
        .calculator-display .result {
            color: var(--tx-meta-color);
            font-size: 1.2rem;
            min-height: 24px;
            /* Reserve space */
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .calculator-buttons button {
            font-size: 1.4rem;
            min-height: 55px;
            margin: 0;
            padding: 0;
            border-radius: 50%;
            /* Make buttons circular */
            background: var(--general-input-bg);
            color: var(--general-input-text);
            border: 1px solid var(--general-input-border);
        }
        
        .calculator-buttons button:hover {
            border-color: var(--general-input-focus-border);
        }
        
        .calculator-buttons button.operator {
            background: var(--tx-controls-bg);
            color: var(--button-voice-bg);
            font-weight: 400;
        }
        
        .calculator-buttons button.function {
            background: var(--tx-controls-bg);
            color: var(--button-delete-bg);
        }
        
        .calculator-buttons button.equals {
            grid-column: span 2;
            border-radius: 30px;
            /* Make it a pill shape */
            background: var(--button-voice-bg);
            color: white;
            border-color: var(--button-voice-bg);
        }
        
        body.theme-dark .calculator-buttons button {
            background: var(--general-input-bg);
            color: var(--general-input-text);
            border-color: var(--general-input-border);
        }
        
        body.theme-dark .calculator-buttons button.operator {
            background: var(--balance-box-bg);
            color: var(--button-voice-active-bg);
        }
        
        body.theme-dark .calculator-buttons button.function {
            background: var(--balance-box-bg);
            color: var(--button-delete-hover-bg);
        }
        
        body.theme-dark .calculator-buttons button.equals {
            background: var(--button-voice-active-bg);
            border-color: var(--button-voice-active-bg);
        }
        /* --- Loader Styles --- */
        
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--header-bg-gradient-start, #34a83a);
            /* Fallback */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
            opacity: 1;
            visibility: visible;
        }
        
        #loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        #loader .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        #loader .loading-text {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            font-family: var(--font-family-system);
        }
        /* Global & Animation Styles */
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 250px;
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes pulseMicrophone {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.15);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes fadeInPage {
            from {
                opacity: 0;
                transform: scale(0.98) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        @keyframes welcomeSlideUpFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes welcomeFadeOut {
            to {
                opacity: 0;
                transform: translateY(10px) scale(0.98);
            }
        }
        
        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutToLeft {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }
        
        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutToRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: var(--font-family-system);
            background: var(--body-bg);
            color: var(--body-text-color);
            width: 100vw;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, color 0.3s;
        }
        
        #root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            flex: 1;
        }
        
        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            position: relative;
            /* For side menu overlay */
        }
        
        .page-container {
            animation: fadeInPage 0.4s ease-out;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        /* --- Organization Setup Screen & Profile Page --- */
        
        .org-setup-screen,
        .profile-page-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(145deg, var(--org-setup-bg-gradient-start) 0%, var(--org-setup-bg-gradient-end) 100%);
            padding: 25px;
            animation: fadeIn 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            color: var(--org-setup-text-color);
        }
        
        .org-setup-content,
        .profile-content {
            background-color: var(--org-setup-card-bg);
            padding: 30px 25px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25), 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 420px;
            border: 1px solid var(--org-setup-card-border);
        }
        
        .org-setup-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            background: var(--org-setup-icon-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--org-setup-icon-text);
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            margin-left: auto;
            margin-right: auto;
        }
        
        .org-setup-content h2,
        .profile-content h2 {
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .org-setup-content p,
        .profile-content p.profile-intro {
            font-size: 0.95rem;
            margin-bottom: 20px;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .org-setup-form,
        .profile-content .profile-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
        }
        
        .org-setup-form label,
        .profile-content .profile-form label {
            font-weight: 500;
            font-size: 0.85rem;
            margin-bottom: 3px;
            opacity: 0.9;
            display: block;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 1rem;
            border-radius: var(--input-border-radius);
            border: 2px solid transparent;
            background-color: var(--form-input-bg);
            color: var(--form-input-text);
            text-align: left;
            margin-bottom: 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.08);
            transition: border-color 0.25s ease, box-shadow 0.25s ease, background-color 0.25s ease, color 0.25s ease;
        }
        
        .form-input::placeholder {
            color: var(--form-input-placeholder);
            opacity: 0.8;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--form-input-focus-border);
            background-color: var(--form-input-focus-bg);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06), 0 0 0 4px var(--form-input-focus-shadow);
        }
        
        .form-input.input-error {
            border-color: var(--form-input-error-border) !important;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06), 0 0 0 4px var(--form-input-error-shadow) !important;
        }
        
        .org-setup-content .form-actions,
        .profile-content .form-actions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .action-button {
            background-color: var(--action-button-bg);
            color: var(--action-button-text);
            padding: 13px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--input-border-radius);
            cursor: pointer;
            width: 100%;
            transition: background-color 0.25s, transform 0.15s, box-shadow 0.25s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-button:hover:not(:disabled) {
            background-color: var(--action-button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
        }
        
        .action-button:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            background-color: var(--action-button-active-bg);
        }
        
        .action-button.secondary-action {
            background-color: var(--action-button-secondary-bg);
        }
        
        .action-button.secondary-action:hover:not(:disabled) {
            background-color: var(--action-button-secondary-hover-bg);
        }
        
        .action-button:disabled {
            background-color: var(--action-button-disabled-bg) !important;
            opacity: 0.7 !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
        }
        
        .profile-back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--header-icon-btn-bg);
            color: var(--header-text-color);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 10;
        }
        
        .profile-back-button:hover {
            background: var(--header-icon-btn-bg-hover);
        }
        /* --- Modernized Header Style (Main Page) --- */
        
        header {
            text-align: center;
            background: linear-gradient(to bottom, var(--header-bg-gradient-start), var(--header-bg-gradient-end));
            color: var(--header-text-color);
            padding: 18px 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            animation: fadeIn 0.5s ease-out;
            position: relative;
            z-index: 10;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 80px;
            width: 100%;
        }
        
        .header-left-cluster {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .header-title-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Centered title area */
            flex-grow: 1;
            text-align: center;
            /* Centered text */
            justify-content: center;
            overflow: hidden;
            margin: 0 auto;
            /* Auto margins for centering */
        }
        
        header h1 {
            margin: 0;
            font-size: 1.9rem;
            line-height: 1.1;
            font-weight: 700;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        header .app-subtitle {
            margin: 2px 0 4px 0;
            font-size: 0.9rem;
            font-weight: 400;
            opacity: 0.9;
            white-space: nowrap;
        }
        
        .header-org-name-display {
            font-size: 0.95rem;
            font-weight: 600;
            opacity: 0.95;
            padding: 4px 10px;
            background-color: var(--header-org-name-bg);
            border-radius: 8px;
            margin-top: 5px;
            display: inline-block;
            max-width: 220px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .header-icon-btn {
            background: var(--header-icon-btn-bg);
            color: var(--header-text-color);
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            padding: 0;
            flex-shrink: 0;
        }
        
        .header-icon-btn:hover:not(:disabled) {
            background: var(--header-icon-btn-bg-hover);
            transform: scale(1.05);
        }
        
        .header-icon-btn:active:not(:disabled) {
            background: var(--header-icon-btn-bg-active);
            transform: scale(1);
        }
        
        .header-icon-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        header .header-placeholder-right {
            width: 38px;
            height: 38px;
            flex-shrink: 0;
            visibility: hidden;
        }
        
        input,
        button,
        select {
            padding: 12px 15px;
            font-size: 0.95rem;
            margin: 6px 0;
            width: 100%;
            box-sizing: border-box;
            border-radius: var(--input-border-radius);
            border: 1px solid var(--general-input-border);
            transition: all 0.2s ease-in-out;
            background-color: var(--general-input-bg);
            color: var(--general-input-text);
        }
        
        input::placeholder {
            color: var(--general-input-placeholder);
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: var(--general-input-focus-border);
            box-shadow: 0 0 0 3px var(--general-input-focus-shadow);
        }
        
        select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        
        body.theme-dark select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%239e9e9e' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: var(--body-bg);
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .form-scrollable-area {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 15px 15px 20px 15px;
            -webkit-overflow-scrolling: touch;
        }
        /* --- Transactions Page Common Header Styles --- */
        
        .transactions-page,
        .image-preview-page {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: var(--tx-page-bg);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .transactions-page header,
        .image-preview-page header {
            background: linear-gradient(to bottom, var(--header-bg-gradient-start), var(--header-bg-gradient-end));
            color: var(--header-text-color);
            padding: 12px 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            position: relative;
            z-index: 10;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .transactions-page header h1,
        .image-preview-page header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }
        
        .transactions-page header .back-button,
        .image-preview-page header .back-button {
            position: static;
            transform: none;
            margin: 0;
            flex-shrink: 0;
            background: var(--header-icon-btn-bg);
            color: var(--header-text-color);
        }
        /* Use header-icon-btn vars */
        
        .transactions-page header .back-button:hover,
        .image-preview-page header .back-button:hover {
            background: var(--header-icon-btn-bg-hover);
        }
        /* Style for the new "Delete All" Icon Button in TransactionsPage Header */
        
        .transactions-page header .header-icon-btn.transactions-delete-all-btn {
            background-color: var(--button-delete-all-bg);
            /* Specific red color */
        }
        
        .transactions-page header .header-icon-btn.transactions-delete-all-btn:hover:not(:disabled) {
            background-color: var(--button-delete-all-hover-bg);
            /* Specific hover red */
        }
        /* Disabled state (opacity) is handled by the base .header-icon-btn:disabled */
        
        .transactions-controls {
            padding: 0 15px 10px 15px;
            background: var(--tx-controls-bg);
            border-bottom: 1px solid var(--tx-controls-border);
        }
        
        .transactions-controls input[type="text"] {
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .filters-sort-group {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            align-items: center;
        }
        
        .filters-sort-group .custom-select-container {
            flex: 1;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-top: 1px solid var(--tx-controls-border);
            background: var(--tx-controls-bg);
            font-size: 0.9rem;
        }
        
        .pagination-controls button {
            width: auto;
            padding: 8px 12px;
            font-size: 0.85rem;
            background-color: var(--button-default-bg);
            color: var(--button-default-text);
        }
        
        .pagination-controls button:disabled {
            background-color: var(--button-disabled-bg);
        }
        
        .pagination-controls span {
            color: var(--body-text-color);
            font-weight: 500;
            opacity: 0.8;
        }
        
        .transactions-list-wrapper {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background: var(--tx-list-wrapper-bg);
        }
        
        .transactions-list {
            padding-bottom: 15px;
        }
        
        .transaction {
            border-bottom: 1px solid var(--tx-item-border);
            padding: 10px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
            font-size: 0.9rem;
        }
        
        .transaction:last-child {
            border-bottom: none;
        }
        
        .transaction:hover {
            background: var(--tx-item-hover-bg);
        }
        
        .transaction-details {
            flex: 1;
            min-width: 0;
            padding-right: 5px;
        }
        
        .transaction-description {
            font-weight: 500;
            white-space: normal;
            word-break: break-word;
            color: var(--tx-desc-color);
        }
        
        .transaction-meta {
            font-size: 0.75rem;
            color: var(--tx-meta-color);
            margin-top: 3px;
        }
        
        .transaction-meta .type {
            font-weight: 500;
        }
        
        .transaction-meta .type.in {
            color: var(--tx-type-in-color);
        }
        
        .transaction-meta .type.out {
            color: var(--tx-type-out-color);
        }
        
        .transaction-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
            margin-left: 8px;
            flex-shrink: 0;
        }
        
        .transaction-amount-value {
            color: var(--tx-amount-color);
            font-weight: 600;
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        .transaction-amount-value.in {
            color: var(--tx-type-in-color);
        }
        
        .transaction-amount-value.out {
            color: var(--tx-type-out-color);
        }
        
        .transaction-action-buttons {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }
        
        .edit-btn,
        .delete-btn {
            background: transparent;
            color: var(--tx-meta-color);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            min-height: auto;
            padding: 0;
            box-shadow: none;
            transition: all 0.2s ease;
        }
        
        .edit-btn:hover:not(:disabled) {
            background: var(--button-edit-hover-bg);
            color: white;
            transform: scale(1.05);
        }
        
        .delete-btn:hover:not(:disabled) {
            background: var(--button-delete-hover-bg);
            color: white;
            transform: scale(1.05);
        }
        
        .edit-btn {
            background-color: var(--button-edit-bg);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--button-delete-bg);
            color: white;
        }
        
        .edit-btn:disabled,
        .delete-btn:disabled {
            background: var(--button-delete-disabled-bg) !important;
            opacity: 0.6 !important;
            cursor: not-allowed !important;
        }
        
        .balance-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 8px;
        }
        
        .balance-box {
            flex: 1;
            font-size: 0.85rem;
            text-align: center;
            padding: 10px 5px;
            background: var(--balance-box-bg);
            border-radius: var(--input-border-radius);
            box-shadow: 0 1px 3px var(--balance-box-shadow);
            border: 1px solid var(--balance-box-border);
        }
        
        .balance-box strong {
            font-weight: 600;
            display: block;
            margin-bottom: 3px;
            color: var(--balance-label-color);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .received strong {
            color: var(--balance-in-text-strong);
        }
        
        .sent strong {
            color: var(--balance-out-text-strong);
        }
        
        .balance strong {
            color: var(--balance-net-text-strong);
        }
        
        .balance-box .amount-value {
            font-size: 1rem;
            font-weight: 600;
        }
        
        .received .amount-value {
            color: var(--balance-in-value-color);
        }
        
        .sent .amount-value {
            color: var(--balance-out-value-color);
        }
        
        .balance .amount-value {
            color: var(--balance-net-value-color);
        }
        /* Language Selector & Custom Select (shared styles where applicable) */
        
        .language-selector,
        .custom-select-container {
            position: relative;
            margin-bottom: 10px;
        }
        
        .language-toggle,
        .custom-select-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            border-radius: var(--input-border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
            width: 100%;
        }
        
        .language-toggle {
            background: var(--lang-selector-bg);
            border: 1px solid var(--lang-selector-border);
            color: var(--body-text-color);
        }
        
        .custom-select-toggle {
            background: var(--custom-select-bg);
            border: 1px solid var(--custom-select-border);
            color: var(--custom-select-text);
        }
        
        .language-toggle:hover:not(:disabled) {
            background: var(--lang-selector-hover-bg);
            border-color: var(--lang-selector-hover-border);
        }
        
        .custom-select-toggle:hover:not(:disabled) {
            background: var(--custom-select-hover-bg);
            border-color: var(--custom-select-hover-border);
        }
        
        .language-toggle-icon,
        .custom-select-arrow {
            transition: transform 0.3s ease;
            margin-left: 5px;
            width: 12px;
            height: 12px;
        }
        
        .language-toggle-icon {
            color: var(--general-input-placeholder);
        }
        
        .custom-select-arrow {
            color: var(--custom-select-arrow-color);
        }
        
        .language-toggle.open .language-toggle-icon,
        .custom-select-toggle.open .custom-select-arrow {
            transform: rotate(180deg);
        }
        
        .language-dropdown,
        .custom-select-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            border-radius: var(--input-border-radius);
            overflow: hidden;
            z-index: 100;
            animation: slideDown 0.3s ease-out forwards;
            transform-origin: top center;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .language-dropdown {
            background: var(--lang-dropdown-bg);
            box-shadow: 0 4px 15px var(--lang-dropdown-shadow);
            border: 1px solid var(--lang-dropdown-border);
        }
        
        .custom-select-dropdown {
            background: var(--custom-select-dropdown-bg);
            box-shadow: 0 4px 15px var(--custom-select-dropdown-shadow);
            border: 1px solid var(--custom-select-dropdown-border);
        }
        
        .language-option,
        .custom-select-option {
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .language-option {
            color: var(--body-text-color);
        }
        
        .custom-select-option {
            color: var(--custom-select-text);
        }
        
        body.theme-dark .custom-select-option {
            color: var(--general-input-text);
        }
        
        .language-option:hover {
            background: var(--lang-option-hover-bg);
        }
        
        .custom-select-option:hover {
            background: var(--custom-select-option-hover-bg);
        }
        
        .language-option.active {
            background: var(--lang-option-active-bg);
            font-weight: 500;
            color: var(--lang-option-active-text);
        }
        
        .custom-select-option.active {
            background: var(--custom-select-option-active-bg);
            font-weight: 500;
            color: var(--custom-select-option-active-text);
        }
        
        .language-flag {
            width: 18px;
            height: 13.5px;
            margin-right: 8px;
            object-fit: cover;
            border-radius: 2px;
            box-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
        }
        
        button {
            background: var(--button-default-bg);
            color: var(--button-default-text);
            border: none;
            cursor: pointer;
            font-weight: 500;
            min-height: 44px;
            font-size: 0.95rem;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border-radius: var(--input-border-radius);
        }
        
        button:hover:not(:disabled) {
            background: var(--button-default-hover-bg);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            background-color: var(--button-default-active-bg);
        }
        
        button:disabled {
            background: var(--button-disabled-bg) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
            transform: none !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
        }
        
        .voice-btn {
            background: var(--button-voice-bg);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.15s ease;
            padding: 0;
            box-shadow: none;
        }
        
        .voice-btn:hover:not(:disabled) {
            background: var(--button-voice-hover-bg);
            transform: scale(1.05);
        }
        
        .voice-btn:active:not(:disabled) {
            background: var(--button-voice-active-bg);
            transform: scale(1);
        }
        
        .voice-btn.listening .icon {
            animation: pulseMicrophone 1.2s infinite ease-in-out;
            color: #ffeb3b;
        }
        
        .input-group {
            display: flex;
            align-items: center;
        }
        
        .input-group input {
            margin-right: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .input-group .voice-btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            margin-left: -1px;
            height: auto;
            align-self: stretch;
            min-height: 44px;
        }
        
        .input-group.rtl-layout input {
            margin-right: auto;
            margin-left: 0;
            border-top-right-radius: var(--input-border-radius);
            border-bottom-right-radius: var(--input-border-radius);
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .input-group.rtl-layout .voice-btn {
            margin-left: auto;
            margin-right: -1px;
            border-top-left-radius: var(--input-border-radius);
            border-bottom-left-radius: var(--input-border-radius);
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .export-options {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .export-options button {
            flex-grow: 1;
            flex-basis: calc(33.333% - 6px);
            font-size: 0.85rem;
            padding: 10px 8px;
            min-width: 80px;
            background-color: var(--button-export-bg);
            color: var(--button-default-text);
        }
        
        .export-options button:hover:not(:disabled) {
            background-color: var(--button-export-hover-bg);
        }
        
        @media (max-width: 380px) {
            .export-options button {
                flex-basis: 100%;
            }
            header,
            .transactions-page header,
            .image-preview-page header {
                padding: 12px 12px;
                min-height: 70px;
            }
            header h1 {
                font-size: 1.7rem;
            }
            header .app-subtitle {
                font-size: 0.85rem;
            }
            .transactions-page header h1,
            .image-preview-page header h1 {
                font-size: 1.1rem;
            }
            .header-org-name-display {
                font-size: 0.85rem;
                max-width: 150px;
                padding: 3px 8px;
            }
            .header-icon-btn {
                width: 34px;
                height: 34px;
                font-size: 1.1rem;
            }
            header .header-placeholder-right {
                width: 34px;
                height: 34px;
            }
        }
        
        .view-transactions-btn {
            margin-top: 10px;
            background: var(--button-view-tx-bg);
            color: var(--button-default-text);
        }
        
        .view-transactions-btn:hover:not(:disabled) {
            background: var(--button-view-tx-hover-bg);
        }
        
        .transaction-type {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .transaction-type button {
            flex: 1;
            padding: 10px;
            font-size: 0.9rem;
            color: var(--button-default-text);
        }
        
        .transaction-type button.active {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
            transform: translateY(1px);
        }
        
        .transaction-type button.receive-btn {
            background: var(--button-tx-type-receive-bg);
        }
        
        .transaction-type button.send-btn {
            background: var(--button-tx-type-send-bg);
        }
        
        .transaction-type button.receive-btn.active {
            background: var(--button-tx-type-receive-active-bg);
        }
        
        .transaction-type button.send-btn.active {
            background: var(--button-tx-type-send-active-bg);
        }
        
        .transaction-type button.receive-btn:hover:not(.active):not(:disabled) {
            background: var(--button-tx-type-receive-active-bg);
        }
        
        .transaction-type button.send-btn:hover:not(.active):not(:disabled) {
            background: var(--button-tx-type-send-active-bg);
        }
        
        .message-container {
            position: fixed;
            top: 10px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: center;
            z-index: 10000;
            pointer-events: none;
        }
        
        .message {
            background: var(--message-bg);
            color: var(--message-text-color);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px var(--message-shadow);
            animation: slideIn 0.3s ease-out forwards;
            display: flex;
            align-items: center;
            max-width: 100%;
            font-size: 0.85rem;
            font-weight: 500;
            pointer-events: auto;
        }
        
        .message.error {
            background: var(--message-error-bg);
            color: var(--message-error-text-color);
        }
        
        .message.success {
            background: var(--message-success-bg);
            color: var(--message-success-text-color);
        }
        
        .message.info {
            background: var(--message-info-bg);
            color: var(--message-info-text-color);
        }
        
        .close-message {
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.7;
            background: none;
            border: none;
            color: inherit;
            font-size: 1.2em;
            padding: 0;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: auto;
        }
        
        .close-message:hover {
            opacity: 1;
        }
        
        .back-button {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--header-icon-btn-bg);
            color: var(--header-text-color);
            border: none;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            min-height: auto;
            font-size: 1.1rem;
            transition: all 0.2s ease;
            padding: 0;
        }
        
        .back-button:hover {
            background: var(--header-icon-btn-bg-hover);
            transform: translateY(-50%) scale(1.05);
        }
        
        .transactions-page .filter-options {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            padding: 0 15px;
        }
        
        .transactions-page .filter-options button {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
            background-color: var(--tx-filter-btn-bg);
            color: var(--tx-filter-btn-text);
            box-shadow: none;
        }
        
        .transactions-page .filter-options button:hover {
            background-color: var(--tx-filter-btn-hover-bg);
        }
        
        .transactions-page .filter-options button.active {
            background-color: var(--tx-filter-btn-active-bg);
            color: var(--tx-filter-btn-active-text);
        }
        
        .no-transactions {
            text-align: center;
            color: var(--no-tx-text-color);
            font-size: 0.9rem;
            margin-top: 30px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .no-transactions svg {
            width: 48px;
            height: 48px;
            opacity: 0.5;
            stroke: var(--no-tx-text-color);
        }
        
        .button-spinner {
            animation: spin 1s linear infinite;
            width: 1em;
            height: 1em;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            display: inline-block;
        }
        /* Modal Styles */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            animation: fadeIn 0.3s ease;
            padding: 15px;
        }
        
        .modal-content {
            background: var(--modal-content-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px var(--modal-content-shadow);
            width: 100%;
            max-width: 370px;
            text-align: center;
            animation: slideIn 0.3s ease-out 0.05s forwards;
            opacity: 0;
            transform: translateY(-20px);
            display: flex;
            flex-direction: column;
        }
        
        .modal-content h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--modal-title-color);
        }
        
        .modal-content p {
            margin-bottom: 25px;
            font-size: 0.95rem;
            color: var(--modal-text-color);
            line-height: 1.6;
        }
        /* Scrollable content for modals */
        
        .modal-scrollable-content {
            max-height: 60vh;
            /* Adjust based on typical screen sizes */
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 10px;
            margin-right: -10px;
            text-align: left;
        }
        
        .modal-scrollable-content[dir="rtl"] {
            padding-right: 0;
            padding-left: 10px;
            margin-right: 0;
            margin-left: -10px;
            text-align: right;
        }
        
        .modal-scrollable-content ul {
            text-align: left;
            padding-left: 20px;
            font-size: 0.9rem;
            color: var(--modal-text-color);
            list-style-position: outside;
        }
        
        .modal-scrollable-content[dir="rtl"] ul {
            text-align: right;
            padding-left: 0;
            padding-right: 20px;
        }
        
        .modal-scrollable-content li {
            margin-bottom: 8px;
        }
        
        .modal-scrollable-content h4 {
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--modal-title-color);
        }
        
        .modal-scrollable-content p {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
        }
        
        .modal-actions button {
            flex-grow: 1;
            padding: 10px 15px;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 8px;
        }
        
        .modal-actions .cancel-btn {
            background-color: var(--modal-cancel-btn-bg);
            color: var(--button-default-text);
        }
        
        .modal-actions .cancel-btn:hover {
            background-color: var(--modal-cancel-btn-hover-bg);
        }
        
        .modal-actions .confirm-btn {
            background-color: var(--modal-confirm-btn-bg);
            color: var(--button-default-text);
        }
        
        .modal-actions .confirm-btn.info-confirm {
            background-color: var(--modal-info-confirm-btn-bg);
        }
        
        .modal-actions .confirm-btn.info-confirm:hover {
            background-color: var(--modal-info-confirm-btn-hover-bg);
        }
        
        .modal-actions .confirm-btn:not(.info-confirm):hover {
            background-color: var(--modal-confirm-btn-hover-bg);
        }
        
        .modal-actions .save-btn {
            background-color: var(--modal-save-btn-bg);
            color: var(--button-default-text);
        }
        
        .modal-actions .save-btn:hover {
            background-color: var(--modal-save-btn-hover-bg);
        }
        
        .modal-actions .close-modal-btn {
            background-color: var(--modal-close-btn-bg);
            color: var(--button-default-text);
        }
        /* For User Manual close */
        
        .modal-actions .close-modal-btn:hover {
            background-color: var(--modal-close-btn-hover-bg);
        }
        /* Edit Transaction Modal Form Styles */
        
        .edit-transaction-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
        }
        
        .edit-transaction-form label {
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--modal-input-label-color);
            margin-bottom: 3px;
            display: block;
        }
        
        .edit-transaction-form input[type="number"],
        .edit-transaction-form input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            font-size: 0.95rem;
            border-radius: var(--input-border-radius);
            border: 1px solid var(--general-input-border);
            background-color: var(--general-input-bg);
            color: var(--general-input-text);
            margin: 0;
        }
        
        .edit-transaction-form input:focus {
            outline: none;
            border-color: var(--general-input-focus-border);
            box-shadow: 0 0 0 3px var(--general-input-focus-shadow);
        }
        
        .edit-transaction-form .transaction-type-display {
            font-size: 0.9rem;
            color: var(--modal-text-color);
            padding: 8px 0;
        }
        
        .edit-transaction-form .transaction-type-display strong {
            color: var(--modal-title-color);
        }
        /* SVG Icon General Style */
        
        .icon {
            width: 1em;
            height: 1em;
            vertical-align: -0.125em;
            fill: currentColor;
        }
        
        @media (max-width: 360px) {
            .org-setup-content,
            .profile-content {
                padding: 20px 15px;
            }
            .org-setup-content h2,
            .profile-content h2 {
                font-size: 1.3rem;
            }
            .org-setup-content p,
            .profile-content p.profile-intro {
                font-size: 0.9rem;
            }
            .form-input {
                padding: 10px 12px;
                font-size: 0.95rem;
            }
            .action-button {
                padding: 10px 15px;
                font-size: 0.95rem;
            }
            .balance-box {
                font-size: 0.8rem;
                padding: 8px 4px;
            }
            .balance-box strong {
                font-size: 0.7rem;
            }
            .balance-box .amount-value {
                font-size: 0.9rem;
            }
            input,
            button,
            select,
            .language-toggle,
            .language-option,
            .custom-select-toggle,
            .custom-select-option {
                font-size: 0.9rem;
                padding: 9px 12px;
            }
            .transaction-type button {
                font-size: 0.85rem;
                padding: 9px;
            }
            .export-options button {
                font-size: 0.75rem;
                padding: 7px 4px;
            }
            .transaction {
                font-size: 0.85rem;
            }
            .voice-btn {
                width: 40px;
                height: 40px;
            }
            .input-group .voice-btn {
                min-height: 40px;
            }
            .modal-content {
                padding: 20px;
            }
            .modal-content h3 {
                font-size: 1.1rem;
            }
            .modal-content p {
                font-size: 0.9rem;
            }
            .filters-sort-group {
                flex-direction: column;
                gap: 10px;
            }
            .filters-sort-group .custom-select-container {
                margin-bottom: 0;
            }
            header {
                min-height: 65px !important;
            }
            header h1 {
                font-size: 1.6rem !important;
            }
            .header-left-cluster {
                gap: 5px;
            }
            /* Reduce gap for very small screens */
            .header-icon-btn {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            header .header-placeholder-right {
                width: 32px;
                height: 32px;
            }
        }
        
        @supports (-webkit-touch-callout: none) {
            input,
            button,
            select {
                -webkit-appearance: none;
            }
        }
        /* Export Element Styles */
        
        .export-element {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 100%;
            max-width: 800px;
            padding: 15px;
            background: #fdfdfd;
            font-family: var(--font-family-system);
            color: #374151;
            box-sizing: border-box;
            border: 1px solid #e0e0e0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .export-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #2e7d32;
        }
        
        .export-title {
            color: #1b5e20;
            font-size: 1.4rem;
            margin: 0 0 4px 0;
            font-weight: 600;
        }
        
        .export-subtitle {
            color: #4b5563;
            font-size: 0.9rem;
            margin: 0;
            font-weight: 500;
        }
        
        .export-page-number {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: right;
            margin-bottom: 5px;
        }
        
        .export-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.85rem;
        }
        
        .export-table th {
            background-color: #2e7d32;
            color: white;
            padding: 9px 6px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #276a2a;
        }
        
        .export-table td {
            padding: 8px 6px;
            border: 1px solid #e5e7eb;
            vertical-align: middle;
            line-height: 1.3;
        }
        
        .export-table tr:nth-child(even) td {
            background-color: #f8f9fa;
        }
        
        .export-table .description-cell {
            min-width: 100px;
            word-break: break-word;
        }
        
        .export-table .amount-cell {
            text-align: right;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .export-summary {
            background: #f9fafb;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px;
            margin-top: 20px;
        }
        
        .export-summary-title {
            font-size: 1.05rem;
            margin: 0 0 10px 0;
            color: #1b5e20;
            font-weight: 600;
            border-bottom: 1px solid #d1d5db;
            padding-bottom: 6px;
        }
        
        .export-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .export-summary-label {
            font-weight: 500;
            color: #4b5563;
        }
        
        .export-summary-value {
            font-weight: 600;
        }
        
        .export-summary .net-balance-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #d1d5db;
            font-size: 0.95rem;
        }
        
        .export-summary .net-balance-row .export-summary-label,
        .export-summary .net-balance-row .export-summary-value {
            font-weight: 700;
            color: #1f2937;
        }
        
        .export-footer {
            text-align: center;
            margin-top: 15px;
            font-size: 0.7rem;
            color: #6b7280;
            padding-top: 8px;
            border-top: 1px solid #e5e7eb;
        }
        
        .export-footer-item {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 2px;
        }
        
        .export-footer-item strong {
            color: #4b5563;
        }
        
        .in-amount,
        .export-type.in {
            color: #16a34a;
            font-weight: 600;
        }
        
        .out-amount,
        .export-type.out {
            color: #ef4444;
            font-weight: 600;
        }
        
        .export-type {
            font-weight: 500;
            font-size: 0.9em;
        }
        /* RTL Export Styles */
        
        .export-element.rtl {
            direction: rtl;
        }
        
        .export-element.rtl .export-header,
        .export-element.rtl .export-footer,
        .export-element.rtl .export-summary {
            text-align: right;
        }
        
        .export-element.rtl .export-table th,
        .export-element.rtl .export-table td {
            text-align: right;
        }
        
        .export-element.rtl .export-page-number {
            text-align: left;
        }
        
        .rtl-text {
            direction: rtl;
            text-align: right;
        }
        
        .export-element.compact-view {
            padding: 10px;
        }
        
        .export-element.compact-view .export-title {
            font-size: 1.1rem;
        }
        
        .export-element.compact-view .export-subtitle {
            font-size: 0.8rem;
        }
        
        .export-element.compact-view .export-page-number {
            font-size: 0.7rem;
        }
        
        .export-element.compact-view .export-table {
            font-size: 0.70rem;
        }
        
        .export-element.compact-view .export-table th,
        .export-element.compact-view .export-table td {
            padding: 4px 3px;
        }
        /* Reduced padding */
        
        .export-element.compact-view .export-table th:nth-child(1),
        .export-element.compact-view .export-table td:nth-child(1) {
            width: 20%;
        }
        /* Amount */
        
        .export-element.compact-view .export-table th:nth-child(2),
        .export-element.compact-view .export-table td:nth-child(2) {
            width: 10%;
        }
        /* Type */
        
        .export-element.compact-view .export-table th:nth-child(3),
        .export-element.compact-view .export-table td:nth-child(3) {
            width: 40%;
        }
        /* Details */
        
        .export-element.compact-view .export-table th:nth-child(4),
        .export-element.compact-view .export-table td:nth-child(4) {
            width: 30%;
        }
        /* Date */
        
        .export-element.compact-view .export-summary {
            padding: 10px;
        }
        
        .export-element.compact-view .export-summary-title {
            font-size: 0.95rem;
        }
        
        .export-element.compact-view .export-summary-row {
            font-size: 0.8rem;
        }
        
        .export-element.compact-view .export-summary .net-balance-row {
            font-size: 0.85rem;
        }
        
        .export-element.compact-view .export-footer-item {
            font-size: 0.65rem;
        }
        /* Welcome Message Overlay Styles */
        
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--welcome-overlay-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        .welcome-overlay.fading-out {
            animation: welcomeFadeOut 0.3s ease-in forwards;
        }
        
        .welcome-message-box {
            background: var(--welcome-box-bg);
            padding: 25px 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px var(--welcome-box-shadow);
            width: 100%;
            max-width: 400px;
            text-align: center;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            animation: welcomeSlideUpFadeIn 0.5s 0.2s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
        }
        
        .welcome-message-box h2 {
            font-size: 1.4rem;
            color: var(--welcome-title-color);
            margin-top: 0;
            margin-bottom: 12px;
        }
        
        .welcome-message-box p {
            font-size: 0.95rem;
            color: var(--welcome-text-color);
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .welcome-message-box button {
            background-color: var(--welcome-button-bg);
            color: var(--welcome-button-text-color);
            padding: 10px 25px;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 8px;
            width: auto;
            min-width: 120px;
        }
        
        .welcome-message-box button:hover {
            background-color: var(--welcome-button-hover-bg);
        }
        /* Image Preview Page Specific Styles */
        
        .image-preview-page {
            background: var(--image-preview-bg);
            color: var(--image-preview-text-color);
            overflow: hidden;
        }
        
        .image-preview-page header {
            background: var(--image-preview-header-bg);
        }
        
        .image-preview-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .image-preview-content .image-wrapper {
            animation-duration: 0.35s;
            animation-timing-function: ease-out;
            animation-fill-mode: forwards;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .image-preview-content img {
            max-width: 100%;
            height: auto;
            border: 3px solid var(--image-preview-image-border);
            border-radius: 8px;
            box-shadow: 0 4px 15px var(--image-preview-image-shadow);
            cursor: pointer;
        }
        
        .image-preview-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 320px;
            margin-top: 15px;
            margin-bottom: 10px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 50px;
        }
        
        body.theme-dark .image-preview-nav {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .image-preview-nav button {
            background-color: var(--image-preview-nav-btn-bg);
            color: var(--button-default-text);
            padding: 8px 12px;
            font-size: 0.9rem;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 4px;
            line-height: 1;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        
        .image-preview-nav button:hover:not(:disabled) {
            background-color: var(--image-preview-nav-btn-hover-bg);
            transform: scale(1.05);
        }
        
        .image-preview-nav button:disabled {
            background-color: var(--button-disabled-bg);
            opacity: 0.6;
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
        }
        
        .image-preview-page-indicator {
            font-size: 1rem;
            color: var(--image-preview-text-color);
            font-weight: 600;
            background-color: var(--body-bg);
            padding: 4px 12px;
            border-radius: 20px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        /* Offline Page Styles */
        
        .offline-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            /* Ensure it takes full viewport height */
            background-color: var(--offline-page-bg);
            color: var(--offline-page-text-color);
            padding: 30px;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            width: 100%;
            /* Ensure it takes full width */
            box-sizing: border-box;
        }
        
        .offline-page .offline-icon-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--header-icon-btn-bg);
            /* Use a theme color */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .offline-page .offline-icon-container .icon {
            font-size: 3rem;
            /* Adjust size as needed */
            color: var(--offline-page-title-color);
            /* Use a prominent theme color */
        }
        
        .offline-page h2 {
            font-size: 1.6rem;
            margin-bottom: 15px;
            color: var(--offline-page-title-color);
            font-weight: 600;
        }
        
        .offline-page p {
            font-size: 1rem;
            line-height: 1.7;
            max-width: 350px;
            /* Limit text width for readability */
            margin-bottom: 25px;
        }
        
        .offline-page .info-text {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        /* Side Menu Styles */
        
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--side-menu-overlay-bg);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s linear;
        }
        
        .side-menu-overlay.open {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0s 0s linear;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            width: 280px;
            max-width: 80%;
            height: 100%;
            background: var(--side-menu-bg);
            color: var(--side-menu-text-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            padding-top: env(safe-area-inset-top, 20px);
            /* Adjust for notch */
        }
        
        .side-menu.rtl {
            transform: translateX(100%);
            right: 0;
            left: auto;
        }
        
        .side-menu.open {
            transform: translateX(0);
        }
        
        .side-menu.open.rtl {
            transform: translateX(0);
        }
        
        .side-menu-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--side-menu-border-color);
            text-align: center;
        }
        
        .side-menu-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--header-bg-gradient-start);
            /* Use app's theme color */
        }
        
        body.theme-dark .side-menu-header h3 {
            color: var(--welcome-title-color);
            /* Dark theme equivalent */
        }
        
        .side-menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .side-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid var(--side-menu-border-color);
        }
        
        .side-menu-item:last-child {
            border-bottom: none;
        }
        
        .side-menu-item:hover {
            background-color: var(--side-menu-item-hover-bg);
        }
        
        .side-menu-item .icon {
            font-size: 1.2rem;
            color: var(--side-menu-item-icon-color);
            flex-shrink: 0;
        }
        
        .side-menu-item span {
            font-size: 0.95rem;
            font-weight: 500;
        }
        /* --- Initial Language Selection Screen Styles --- */
        
        .initial-lang-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(145deg, var(--header-bg-gradient-start) 0%, var(--header-bg-gradient-end) 100%);
            color: var(--header-text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10003;
            /* Above welcome overlay */
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }
        
        .initial-lang-content {
            text-align: center;
            animation: welcomeSlideUpFadeIn 0.6s 0.2s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
            opacity: 0;
        }
        
        .initial-lang-content h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .initial-lang-content p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .initial-lang-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .initial-lang-option {
            background: var(--org-setup-card-bg);
            border: 2px solid var(--org-setup-card-border);
            padding: 25px 40px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .initial-lang-option:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .initial-lang-option img {
            width: 50px;
            height: auto;
            margin-bottom: 15px;
        }
        
        .initial-lang-option span {
            font-size: 1.2rem;
            font-weight: 600;
            display: block;
        }
        
        .language-modal-option {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: var(--modal-cancel-btn-bg);
            color: var(--button-default-text);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .language-modal-option:hover {
            background-color: var(--modal-cancel-btn-hover-bg);
        }
        
        body.theme-dark .language-modal-option {
            background-color: var(--modal-cancel-btn-bg);
        }
        
        body.theme-dark .language-modal-option:hover {
            background-color: var(--modal-cancel-btn-hover-bg);
        }
        
        .language-modal-option img {
            width: 24px;
            height: auto;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <div id="loader">
        <div class="spinner"></div>
        <div class="loading-text">Spend Wise</div>
    </div>

    <div id="root">
        <!-- React app will be rendered here -->
    </div>

    <script src="cordova.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const {
            useState,
            useEffect,
            Fragment,
            useRef,
            useCallback
        } = React;

        // --- SVG Icons ---
        const IconArrowLeft = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",
            clipRule: "evenodd"
        }));
        const IconTrash = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.177-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25V4c.827-.05 1.66-.075 2.5-.075zM8.47 9.03a.75.75 0 011.06 0l1.25 1.25a.75.75 0 01-1.06 1.06L9.47 10.09l-1.25 1.25a.75.75 0 01-1.06-1.06l1.25-1.25a.75.75 0 010-1.06zM10.53 9.03a.75.75 0 00-1.06 0l-1.25 1.25a.75.75 0 101.06 1.06l1.25-1.25L12.53 10.09l1.25 1.25a.75.75 0 101.06-1.06l-1.25-1.25a.75.75 0 00-1.06 0z",
            clipRule: "evenodd"
        }));
        const IconChevronDown = ({
            className = "language-toggle-icon"
        }) => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: `icon ${className}`
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M5.22 8.22a.75.75 0 011.06 0L10 11.94l3.72-3.72a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.22 9.28a.75.75 0 010-1.06z",
            clipRule: "evenodd"
        }));
        const IconMicrophone = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            d: "M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z"
        }), React.createElement('path', {
            fillRule: "evenodd",
            d: "M5.5 8.5A.5.5 0 016 8h1v1.07A4.502 4.502 0 0010 13.43A4.5 4.5 0 0013 9.07V8h1a.5.5 0 01.5.5v.5a.5.5 0 01-.5.5h-.141a4.494 4.494 0 00-1.196 3.007V15.5a.5.5 0 01-.5.5h-2.626a.5.5 0 01-.5-.5v-2.486A4.493 4.493 0 006.64 9.5H6.5a.5.5 0 01-.5.5v-.5z",
            clipRule: "evenodd"
        }));
        const IconNoData = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            fill: "none",
            viewBox: "0 0 24 24",
            strokeWidth: 1.5,
            stroke: "currentColor"
        }, React.createElement('path', {
            strokeLinecap: "round",
            strokeLinejoin: "round",
            d: "M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"
        }));
        const IconClose = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            d: "M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"
        }));
        const IconPencil = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon"
        }, React.createElement('path', {
            d: "M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
        }), React.createElement('path', {
            fillRule: "evenodd",
            d: "M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",
            clipRule: "evenodd"
        }));
        const IconSave = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            d: "M3.75 3.75a.75.75 0 00-1.5 0v12.5c0 .414.336.75.75.75h13.5a.75.75 0 00.75-.75V6.75a.75.75 0 00-1.5 0v9.5H3.75V3.75z"
        }), React.createElement('path', {
            d: "M10.75 10.75a.75.75 0 001.5 0V2.811l1.97 1.97a.75.75 0 001.06-1.06l-3.25-3.25a.75.75 0 00-1.06 0L7.72 3.72a.75.75 0 101.06 1.06l1.97-1.97v7.939z"
        }));
        const IconWifiOff = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon"
        }, React.createElement('path', {
            d: "M2.004 8.174a14.193 14.193 0 0115.992 0 .75.75 0 00.957-1.158 15.693 15.693 0 00-17.906 0 .75.75 0 00.957 1.158z"
        }), React.createElement('path', {
            d: "M4.56 10.44a9.733 9.733 0 0110.88 0 .75.75 0 00.957-1.158 11.233 11.233 0 00-12.794 0 .75.75 0 00.957 1.158z"
        }), React.createElement('path', {
            d: "M7.634 12.707a5.273 5.273 0 014.732 0 .75.75 0 00.957-1.158 6.773 6.773 0 00-6.646 0 .75.75 0 00.957 1.158z"
        }), React.createElement('path', {
            fillRule: "evenodd",
            d: "M10.002 16.25a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zM2.48 3.547a.75.75 0 00-1.06 1.06L4.068 7.255 2.677 8.97a.75.75 0 001.133 1.004L6.61 7.405a.75.75 0 00-1.06-1.06L4.42 7.542l-1.94-2.06ZM18.58 15.453a.75.75 0 001.06-1.06l-2.648-2.817 1.392-1.723a.75.75 0 00-1.133-1.004l-2.8 3.573a.75.75 0 001.06 1.06l1.129-1.197 1.94 2.06Z",
            clipRule: "evenodd"
        }));
        const IconMenu = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 5A.75.75 0 012.75 9h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 9.75zm0 5A.75.75 0 012.75 14h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 14.75z",
            clipRule: "evenodd"
        }));
        const IconChevronLeft = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",
            clipRule: "evenodd"
        }));
        const IconChevronRight = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon w-5 h-5"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",
            clipRule: "evenodd"
        }));
        const IconCalculator = () => React.createElement('svg', {
            viewBox: "0 0 20 20",
            fill: "currentColor",
            className: "icon"
        }, React.createElement('path', {
            fillRule: "evenodd",
            d: "M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v10H5V5z",
            clipRule: "evenodd"
        }), React.createElement('path', {
            d: "M7 7h2v2H7V7zm4 0h2v2h-2V7zM7 11h2v2H7v-2zm4 0h2v2h-2v-2z"
        }));

        // --- IndexedDB Helper Functions ---
        const DB_NAME = 'SpendWiseDB_v7_Local';
        const TX_STORE_NAME = 'transactions_v7_local';
        const DB_VERSION = 1;

        function openDB() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) {
                    console.warn("IndexedDB not supported.");
                    reject("IndexedDB not supported by this browser/WebView.");
                    return;
                }
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = (event) => {
                    console.error("DB Open Error:", event.target.error);
                    reject("Error opening DB: " + (event.target.error ? event.target.error.name : "Unknown error"));
                };
                request.onsuccess = (event) => {
                    console.log("DB Opened Successfully");
                    resolve(event.target.result);
                };
                request.onupgradeneeded = (event) => {
                    console.log("DB Upgrade Needed");
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(TX_STORE_NAME)) {
                        console.log("Creating Object Store:", TX_STORE_NAME);
                        db.createObjectStore(TX_STORE_NAME, {
                            keyPath: 'timestamp'
                        });
                    }
                };
            });
        }
        async function getAllTransactionsDB() {
            console.log("DB: Attempting to get all transactions.");
            try {
                const db = await openDB();
                return new Promise((resolve, reject) => {
                    if (!db.objectStoreNames.contains(TX_STORE_NAME)) {
                        console.warn("DB: Transaction store not found.");
                        resolve([]);
                        return;
                    }
                    const transaction = db.transaction(TX_STORE_NAME, 'readonly');
                    const store = transaction.objectStore(TX_STORE_NAME);
                    const request = store.getAll();
                    request.onerror = (event) => {
                        console.error("DB: Error fetching transactions:", event.target.error);
                        reject("Error fetching transactions: " + (event.target.error ? event.target.error.name : "Unknown error"));
                    };
                    request.onsuccess = (event) => {
                        console.log("DB: Transactions fetched successfully.", event.target.result.length);
                        resolve(event.target.result.sort((a, b) => b.timestamp - a.timestamp));
                    };
                });
            } catch (error) {
                console.error("DB Error in getAllTransactionsDB:", error);
                return [];
            }
        }
        async function addTransactionDB(newTx) {
            console.log("DB: Attempting to add transaction:", newTx.timestamp);
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(TX_STORE_NAME, 'readwrite');
                const store = transaction.objectStore(TX_STORE_NAME);
                const request = store.add(newTx);
                request.onerror = (event) => {
                    console.error("DB: Error adding transaction:", event.target.error);
                    reject("Error adding transaction: " + (event.target.error ? event.target.error.name : "Unknown error"));
                };
                request.onsuccess = (event) => {
                    console.log("DB: Transaction added successfully:", event.target.result);
                    resolve(event.target.result);
                };
            });
        }
        async function updateTransactionDB(updatedTx) {
            console.log("DB: Attempting to update transaction:", updatedTx.timestamp);
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transactionStore = db.transaction(TX_STORE_NAME, 'readwrite').objectStore(TX_STORE_NAME);
                const request = transactionStore.put(updatedTx);
                request.onerror = (event) => {
                    console.error("DB: Error updating transaction:", event.target.error);
                    reject("Error updating transaction: " + (event.target.error ? event.target.error.name : "Unknown error"));
                };
                request.onsuccess = (event) => {
                    console.log("DB: Transaction updated successfully:", event.target.result);
                    resolve(event.target.result);
                };
            });
        }
        async function deleteTransactionDB(timestamp) {
            console.log("DB: Attempting to delete transaction:", timestamp);
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(TX_STORE_NAME, 'readwrite');
                const store = transaction.objectStore(TX_STORE_NAME);
                const request = store.delete(timestamp);
                request.onerror = (event) => {
                    console.error("DB: Error deleting transaction:", event.target.error);
                    reject("Error deleting transaction: " + (event.target.error ? event.target.error.name : "Unknown error"));
                };
                request.onsuccess = (event) => {
                    console.log("DB: Transaction deleted successfully.");
                    resolve();
                };
            });
        }
        async function deleteAllTransactionsDB() {
            console.log("DB: Attempting to delete ALL transactions.");
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(TX_STORE_NAME, 'readwrite');
                const store = transaction.objectStore(TX_STORE_NAME);
                const request = store.clear(); // Clears all data from the object store
                request.onerror = (event) => {
                    console.error("DB: Error deleting all transactions:", event.target.error);
                    reject("Error deleting all transactions: " + (event.target.error ? event.target.error.name : "Unknown error"));
                };
                request.onsuccess = (event) => {
                    console.log("DB: All transactions deleted successfully.");
                    resolve();
                };
            });
        }

        // --- Components ---
        function Message({
            text,
            type,
            onClose,
            language
        }) {
            return React.createElement('div', {
                    className: `message ${type}`
                },
                text,
                React.createElement('button', {
                    className: "close-message",
                    onClick: onClose,
                    "aria-label": language === 'en' ? "Close message" : "  "
                }, React.createElement(IconClose, null))
            );
        }

        function Modal({
            isOpen,
            onClose,
            title,
            children,
            onConfirm,
            confirmText = "Confirm",
            cancelText = "Cancel",
            language,
            confirmButtonClass = "",
            customActions,
            isSingleAction = false,
            contentClassName = ""
        }) {
            if (!isOpen) return null;
            return React.createElement('div', {
                    className: "modal-overlay",
                    onClick: onClose
                },
                React.createElement('div', {
                        className: `modal-content ${contentClassName}`,
                        onClick: (e) => e.stopPropagation()
                    },
                    React.createElement('h3', null, title),
                    children,
                    customActions ? customActions :
                    React.createElement('div', {
                            className: "modal-actions",
                            style: isSingleAction ? {
                                justifyContent: 'center'
                            } : {}
                        }, !isSingleAction && React.createElement('button', {
                            className: "cancel-btn",
                            onClick: onClose
                        }, language === 'en' ? cancelText : ' '),
                        onConfirm && React.createElement('button', {
                            className: `confirm-btn ${confirmButtonClass}`,
                            onClick: onConfirm
                        }, language === 'en' ? confirmText : ' ')
                    )
                )
            );
        }

        function InitialLanguageScreen({
            onSelect
        }) {
            return React.createElement('div', {
                    className: "initial-lang-screen"
                },
                React.createElement('div', {
                        className: "initial-lang-content"
                    },
                    React.createElement('h1', null, "Choose Language"),
                    React.createElement('p', null, "    "),
                    React.createElement('div', {
                            className: "initial-lang-options"
                        },
                        React.createElement('div', {
                                className: "initial-lang-option",
                                onClick: () => onSelect('en')
                            },
                            React.createElement('img', {
                                src: "https://flagcdn.com/w80/gb.png",
                                alt: "UK Flag"
                            }),
                            React.createElement('span', null, "English")
                        ),
                        React.createElement('div', {
                                className: "initial-lang-option",
                                onClick: () => onSelect('ur')
                            },
                            React.createElement('img', {
                                src: "https://flagcdn.com/w80/pk.png",
                                alt: "Pakistan Flag"
                            }),
                            React.createElement('span', null, "")
                        )
                    )
                )
            );
        }

        function LanguageSelectionModal({
            isOpen,
            onClose,
            onSelect,
            languages
        }) {
            return React.createElement(Modal, {
                    isOpen: isOpen,
                    onClose: onClose,
                    title: "Change Language /   ",
                    isSingleAction: true,
                    customActions: React.createElement(Fragment, null)
                },
                React.createElement('div', null,
                    languages.map(lang =>
                        React.createElement('button', {
                                key: lang.code,
                                className: "language-modal-option",
                                onClick: () => onSelect(lang.code)
                            },
                            React.createElement('img', {
                                src: lang.flag,
                                alt: `${lang.name} flag`
                            }),
                            React.createElement('span', null, lang.name)
                        )
                    )
                )
            );
        }

        function OfflinePage({
            language
        }) {
            return React.createElement('div', {
                    className: "offline-page"
                },
                React.createElement('div', {
                        className: "offline-icon-container"
                    },
                    React.createElement(IconWifiOff, {
                        className: "icon"
                    })
                ),
                React.createElement('h2', null, language === 'en' ? 'You Are Offline' : '   '),
                React.createElement('p', null, language === 'en' ? 'Spend Wise needs an internet connection to get started. Please check your connection and try again.' : '                    '),
                React.createElement('p', {
                    className: "info-text"
                }, language === 'en' ? 'Once set up, most features will work offline.' : '              ')
            );
        }

        function UserManualModal({
            isOpen,
            onClose,
            language
        }) {
            return React.createElement(Modal, {
                    isOpen: isOpen,
                    onClose: onClose,
                    title: language === 'en' ? "User Manual" : " ",
                    language: language,
                    isSingleAction: true,
                    customActions: React.createElement('div', {
                            className: "modal-actions",
                            style: {
                                justifyContent: 'center'
                            }
                        },
                        React.createElement('button', {
                            className: "close-modal-btn",
                            onClick: onClose
                        }, language === 'en' ? 'Close' : ' ')
                    )
                },
                React.createElement('div', {
                        className: "modal-scrollable-content",
                        dir: language === 'ur' ? 'rtl' : 'ltr'
                    },
                    React.createElement('ul', null,
                        React.createElement('li', null, language === 'en' ? "Welcome to Spend Wise! Track your finances with ease." : "    !       "),
                        React.createElement('li', null, language === 'en' ? "Adding Transactions: Select 'In' (income) or 'Out' (expense), enter the amount and a brief description, then tap 'Add Transaction'." : "   : '' ()  '' ()          '   '   "),
                        React.createElement('li', null, language === 'en' ? "Voice Input: For descriptions, tap the microphone icon next to the details field to use voice-to-text. This may require internet and permission." : "  :                             "),
                        React.createElement('li', null, language === 'en' ? "View & Manage: Tap 'View Transactions' to see your history. You can filter, sort, edit, or delete entries. You can also delete all transactions from this page using the trash icon in the header." : "   :      '  '                                       "),
                        React.createElement('li', null, language === 'en' ? "Image Reports: Generate paginated image-based financial reports for weekly, monthly, or all transactions. Double-tap any page of the generated image preview to share all pages of the report." : " :                                     "),
                        React.createElement('li', null, language === 'en' ? "Profile & Settings: Access via the side menu to set or update your organization and personal name." : "  :                     "),
                        React.createElement('li', null, language === 'en' ? "Theme: Switch between light and dark visual themes from the side menu." : ":            "),
                        React.createElement('li', null, language === 'en' ? "Language: Choose between English and Urdu using the language selector on the main screen." : ":                 ")
                    )
                )
            );
        }

        function PrivacyPolicyModal({
            isOpen,
            onClose,
            language
        }) {
            return React.createElement(Modal, {
                    isOpen: isOpen,
                    onClose: onClose,
                    title: language === 'en' ? "Privacy Policy" : "  ",
                    language: language,
                    isSingleAction: true,
                    customActions: React.createElement('div', {
                            className: "modal-actions"
                        },
                        React.createElement('button', {
                            className: "close-modal-btn",
                            onClick: onClose
                        }, language === 'en' ? 'Close' : ' ')
                    )
                },
                React.createElement('div', {
                        className: "modal-scrollable-content",
                        dir: language === 'ur' ? 'rtl' : 'ltr'
                    },
                    React.createElement('h4', null, language === 'en' ? 'Effective Date: 6-JUNE-2025' : ' : 6--2025'),
                    React.createElement('p', null, language === 'en' ? "'Spend Wise' is a personal expense manager developed by TRONEX. Your privacy is important to us. This Privacy Policy explains how we collect, use, and protect your data." : "' ' TRONEX                                   "),

                    React.createElement('h4', null, language === 'en' ? '1. Data Collection' : '.   '),
                    React.createElement('p', null, language === 'en' ? "We do not collect or store personal information on any external server." : "             "),
                    React.createElement('p', null, language === 'en' ? "We may access the following device features (only when you use related features):" : "           (       ):"),
                    React.createElement('ul', null,
                        React.createElement('li', null, language === 'en' ? "Microphone  for optional voice input" : " -      "),
                        React.createElement('li', null, language === 'en' ? "File Storage  for exporting or sharing reports" : "  -        "),
                        React.createElement('li', null, language === 'en' ? "Network Status  to notify you if you are offline/online" : "   -    /       "),
                        React.createElement('li', null, language === 'en' ? "Device Info  to improve performance on different phones" : "   -         "),
                    ),

                    React.createElement('h4', null, language === 'en' ? '2. Data Usage' : '.   '),
                    React.createElement('p', null, language === 'en' ? "All expense data, reports, and voice input remain local on your phone unless you choose to:" : "                        :"),
                    React.createElement('ul', null,
                        React.createElement('li', null, language === 'en' ? "Export or share receipts/images via apps like WhatsApp or email" : "         /    "),
                        React.createElement('li', null, language === 'en' ? "Use speech-to-text for faster data entry (processed locally via device OS or speech plugin)" : "           ( OS             )"),
                    ),
                    React.createElement('p', null, language === 'en' ? "We do not track or transmit any financial or personal information." : "             "),

                    React.createElement('h4', null, language === 'en' ? '3. Third-Party Services' : '.    '),
                    React.createElement('p', null, language === 'en' ? "The App may interact with sharing apps (like WhatsApp, Gmail, etc.) when you choose to share reports. These services follow their own privacy policies. Spend Wise does not control or retain any data shared through them." : "   (     )                                           "),

                    React.createElement('h4', null, language === 'en' ? '4. Your Control' : '.   '),
                    React.createElement('p', null, language === 'en' ? "You can:" : "   :"),
                    React.createElement('ul', null,
                        React.createElement('li', null, language === 'en' ? "Delete any data manually at any time" : "          "),
                        React.createElement('li', null, language === 'en' ? "Uninstall the app to remove all app data" : "           "),
                        React.createElement('li', null, language === 'en' ? "Control permissions (microphone, storage) via your phone settings" : "       ( )   "),
                    ),

                    React.createElement('h4', null, language === 'en' ? '5. Beta Testing Note' : '.   '),
                    React.createElement('p', null, language === 'en' ? "Spend Wise is currently in beta. During this testing phase, features may change and you may encounter bugs. Your feedback helps us improve the app while we keep your data safe and local." : "                                              "),

                    React.createElement('h4', null, language === 'en' ? 'Contact Us' : '   '),
                    React.createElement('p', null, language === 'en' ? "If you have questions or concerns, reach out to us at: support@tronex.com" : "            : support@tronex.com")
                )
            );
        }

        function VoicePermissionPreDialog({
            isOpen,
            onAllow,
            onDeny,
            language
        }) {
            return React.createElement(Modal, {
                    isOpen: isOpen,
                    onClose: onDeny, // Clicking overlay denies
                    title: language === 'en' ? "Voice Input Permission" : "    ",
                    language: language,
                    customActions: React.createElement('div', {
                            className: "modal-actions"
                        },
                        React.createElement('button', {
                            className: "cancel-btn",
                            onClick: onDeny
                        }, language === 'en' ? 'Not Now' : ' '),
                        React.createElement('button', {
                            className: "confirm-btn info-confirm",
                            onClick: onAllow
                        }, language === 'en' ? 'Allow Access' : '   ')
                    )
                },
                React.createElement('div', {
                        style: {
                            textAlign: language === 'ur' ? 'right' : 'left',
                            direction: language === 'ur' ? 'rtl' : 'ltr'
                        }
                    },
                    React.createElement('p', null, language === 'en' ? "To use voice input for transaction details, Spend Wise needs access to your microphone." : "                      "),
                    React.createElement('p', null, language === 'en' ? "Tap 'Allow Access' to proceed with the system permission request. You can manage this in your device settings later." : "           '   '                 ")
                )
            );
        }


        function OrganizationSetupScreen({
            onSave,
            language,
            showNotification
        }) {
            const [orgName, setOrgName] = useState('');
            const [personalName, setPersonalName] = useState('');
            const [orgNameError, setOrgNameError] = useState(false);
            const orgNameInputRef = useRef(null);

            useEffect(() => {
                if (orgNameInputRef.current) {
                    orgNameInputRef.current.focus();
                }
            }, []);

            const handleSaveClick = () => {
                if (orgName.trim() === '') {
                    setOrgNameError(true);
                    showNotification(language === 'en' ? 'Organization name is required.' : '    ', 'error');
                    if (orgNameInputRef.current) orgNameInputRef.current.focus();
                    return;
                }
                setOrgNameError(false);
                onSave({
                    orgName: orgName.trim(),
                    personalName: personalName.trim()
                });
            };

            return React.createElement('div', {
                    className: "org-setup-screen"
                },
                React.createElement('div', {
                        className: "org-setup-content"
                    },
                    React.createElement('div', {
                        className: "org-setup-icon"
                    }, "$"),
                    React.createElement('h2', null, language === 'en' ? 'Welcome to Spend Wise!' : '    !'),
                    React.createElement('p', null, language === 'en' ? 'Let\'s get you set up. Please provide some initial details.' : '             '),
                    React.createElement('div', {
                            className: "org-setup-form"
                        },
                        React.createElement('div', null,
                            React.createElement('label', {
                                htmlFor: "setupOrgName"
                            }, language === 'en' ? 'Organization Name *' : '   *'),
                            React.createElement('input', {
                                ref: orgNameInputRef,
                                type: "text",
                                id: "setupOrgName",
                                className: `form-input ${orgNameError ? 'input-error' : ''}`,
                                value: orgName,
                                onChange: (e) => {
                                    setOrgName(e.target.value);
                                    if (e.target.value.trim()) setOrgNameError(false);
                                },
                                placeholder: language === 'en' ? 'E.g., My Business, Home Expenses' : '    ',
                                onKeyPress: (e) => e.key === 'Enter' && handleSaveClick()
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', {
                                htmlFor: "setupPersonalName"
                            }, language === 'en' ? 'Your Name (Optional)' : '   ()'),
                            React.createElement('input', {
                                type: "text",
                                id: "setupPersonalName",
                                className: "form-input",
                                value: personalName,
                                onChange: (e) => setPersonalName(e.target.value),
                                placeholder: language === 'en' ? 'E.g., John Doe' : '  '
                            })
                        )
                    ),
                    React.createElement('div', {
                            className: "form-actions"
                        },
                        React.createElement('button', {
                                className: "action-button",
                                onClick: handleSaveClick
                            },
                            language === 'en' ? 'Save and Continue' : '    '
                        )
                    )
                )
            );
        }

        function ProfilePage({
            language,
            onBack,
            initialPersonalName,
            initialOrgName,
            onSaveProfile,
            showNotification
        }) {
            const [personalNameState, setPersonalNameState] = useState('');
            const [orgNameState, setOrgNameState] = useState('');
            const [orgNameError, setOrgNameError] = useState(false);
            const [isSaving, setIsSaving] = useState(false);
            const orgNameInputRef = useRef(null);

            useEffect(() => {
                setPersonalNameState(initialPersonalName || '');
                setOrgNameState(initialOrgName || '');
            }, [initialPersonalName, initialOrgName]);

            const handleSave = async() => {
                if (orgNameState.trim() === '') {
                    setOrgNameError(true);
                    showNotification(language === 'en' ? 'Organization name cannot be empty.' : '      ', 'error');
                    if (orgNameInputRef.current) orgNameInputRef.current.focus();
                    return;
                }
                setOrgNameError(false);
                setIsSaving(true);
                try {
                    await onSaveProfile({
                        personalName: personalNameState.trim(),
                        orgName: orgNameState.trim()
                    });
                } catch (e) {
                    showNotification(language === 'en' ? 'Error saving profile.' : '    ', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

            return React.createElement('div', {
                    className: "profile-page-screen"
                },
                React.createElement('button', {
                    className: "profile-back-button",
                    onClick: onBack,
                    "aria-label": language === 'en' ? "Go back" : " "
                }, React.createElement(IconArrowLeft, null)),
                React.createElement('div', {
                        className: "profile-content"
                    },
                    React.createElement('h2', null, language === 'en' ? 'Profile & Settings' : '  '),
                    React.createElement('p', {
                        className: "profile-intro"
                    }, language === 'en' ? 'Manage your personal and organization details.' : '        '),
                    React.createElement('div', {
                            className: "profile-form"
                        },
                        React.createElement('div', null,
                            React.createElement('label', {
                                htmlFor: "personalName"
                            }, language === 'en' ? 'Your Name' : '  '),
                            React.createElement('input', {
                                type: "text",
                                id: "personalName",
                                className: "form-input",
                                value: personalNameState,
                                onChange: (e) => setPersonalNameState(e.target.value),
                                placeholder: language === 'en' ? 'E.g., John Doe' : '  ',
                                disabled: isSaving
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', {
                                htmlFor: "orgName"
                            }, language === 'en' ? 'Organization Name *' : '   *'),
                            React.createElement('input', {
                                ref: orgNameInputRef,
                                type: "text",
                                id: "orgName",
                                className: `form-input ${orgNameError ? 'input-error' : ''}`,
                                value: orgNameState,
                                onChange: (e) => {
                                    setOrgNameState(e.target.value);
                                    if (e.target.value.trim()) setOrgNameError(false);
                                },
                                placeholder: language === 'en' ? 'Your Organization Name' : '    ',
                                disabled: isSaving
                            })
                        )
                    ),
                    React.createElement('div', {
                            className: "form-actions"
                        },
                        React.createElement('button', {
                                className: "action-button",
                                onClick: handleSave,
                                disabled: isSaving
                            },
                            isSaving ? React.createElement('span', {
                                className: "button-spinner"
                            }) : React.createElement(IconSave, null),
                            language === 'en' ? 'Save Profile' : '  '
                        )
                    )
                )
            );
        }

        function CustomSelect({
            options,
            value,
            onChange,
            language,
            placeholderText,
            disabled
        }) {
            const [isOpen, setIsOpen] = useState(false);
            const dropdownRef = useRef(null);
            const buttonRef = useRef(null);

            const selectedOption = options.find(opt => opt.value === value);
            const displayLabel = selectedOption ? selectedOption.label : placeholderText;

            const toggleOpen = () => !disabled && setIsOpen(!isOpen);

            const handleSelect = (optionValue) => {
                onChange({
                    target: {
                        value: optionValue
                    }
                });
                setIsOpen(false);
            };

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target) &&
                        buttonRef.current && !buttonRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const directionClass = language === 'ur' ? 'rtl-text' : '';

            return React.createElement('div', {
                    className: "custom-select-container",
                    ref: dropdownRef
                },
                React.createElement('button', {
                        ref: buttonRef,
                        type: "button",
                        className: `custom-select-toggle ${isOpen ? 'open' : ''} ${directionClass}`,
                        onClick: toggleOpen,
                        disabled: disabled,
                        "aria-haspopup": "listbox",
                        "aria-expanded": isOpen,
                        "aria-label": placeholderText || (language === 'en' ? 'Select an option' : '   ')
                    },
                    React.createElement('span', {
                        className: directionClass
                    }, displayLabel),
                    React.createElement(IconChevronDown, {
                        className: "custom-select-arrow"
                    })
                ),
                isOpen && React.createElement('ul', {
                        className: "custom-select-dropdown",
                        role: "listbox"
                    },
                    options.map(option => React.createElement('li', {
                            key: option.value,
                            onClick: () => handleSelect(option.value),
                            role: "option",
                            "aria-selected": option.value === value,
                            className: `custom-select-option ${option.value === value ? 'active' : ''} ${directionClass}`
                        },
                        option.label
                    ))
                )
            );
        }

        function TransactionsPage({
            transactions,
            language,
            onBack,
            onDeleteConfirm,
            onEditTransaction,
            organizationName,
            onDeleteAllConfirm
        }) {
            const [typeFilter, setTypeFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('date_desc');
            const [currentPageNum, setCurrentPageNum] = useState(1);
            const itemsPerPage = 10;

            const formatDate = (ts) => new Date(ts).toLocaleString(language === 'en' ? 'en-US' : 'ur-PK', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            let processedTransactions = transactions.filter(t => {
                if (typeFilter !== 'all' && t.type !== typeFilter) return false;
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const descMatch = t.description.toLowerCase().includes(searchLower);
                    const amountMatch = t.amount.toString().includes(searchLower);
                    if (!descMatch && !amountMatch) return false;
                }
                return true;
            });

            processedTransactions.sort((a, b) => {
                switch (sortBy) {
                    case 'date_asc':
                        return a.timestamp - b.timestamp;
                    case 'amount_desc':
                        return Math.abs(b.amount) - Math.abs(a.amount);
                    case 'amount_asc':
                        return Math.abs(a.amount) - Math.abs(b.amount);
                    case 'date_desc':
                    default:
                        return b.timestamp - a.timestamp;
                }
            });

            const indexOfLastItem = currentPageNum * itemsPerPage;
            const indexOfFirstItem = indexOfLastItem - itemsPerPage;
            const currentPagedTransactions = processedTransactions.slice(indexOfFirstItem, indexOfLastItem);
            const totalPages = Math.ceil(processedTransactions.length / itemsPerPage);

            const paginate = (pageNumber) => {
                if (pageNumber < 1 || pageNumber > totalPages) return;
                setCurrentPageNum(pageNumber);
            };

            const sortOptions = [{
                value: 'date_desc',
                label: language === 'en' ? 'Date (Newest)' : ' ( )'
            }, {
                value: 'date_asc',
                label: language === 'en' ? 'Date (Oldest)' : ' ( )'
            }, {
                value: 'amount_desc',
                label: language === 'en' ? 'Amount (High-Low)' : ' (  )'
            }, {
                value: 'amount_asc',
                label: language === 'en' ? 'Amount (Low-High)' : ' (  )'
            }, ];

            return React.createElement('div', {
                    className: "transactions-page"
                },
                React.createElement('header', null,
                    React.createElement('button', {
                        className: "back-button header-icon-btn",
                        onClick: onBack,
                        "aria-label": language === 'en' ? "Go back" : " "
                    }, React.createElement(IconArrowLeft, null)),
                    React.createElement('h1', null, organizationName, " ", language === 'en' ? 'Transactions' : '  '),
                    React.createElement('button', {
                        className: "header-icon-btn transactions-delete-all-btn",
                        onClick: onDeleteAllConfirm,
                        disabled: transactions.length === 0,
                        "aria-label": language === 'en' ? "Delete All Transactions" : "    ",
                        title: language === 'en' ? "Delete All Transactions" : "    "
                    }, React.createElement(IconTrash, null))
                ),
                React.createElement('div', {
                        className: "filter-options"
                    },
                    React.createElement('button', {
                        className: typeFilter === 'all' ? 'active' : '',
                        onClick: () => {
                            setTypeFilter('all');
                            setCurrentPageNum(1);
                        }
                    }, language === 'en' ? 'All Types' : ' '),
                    React.createElement('button', {
                        className: typeFilter === 'receive' ? 'active' : '',
                        onClick: () => {
                            setTypeFilter('receive');
                            setCurrentPageNum(1);
                        }
                    }, language === 'en' ? 'In' : ''),
                    React.createElement('button', {
                        className: typeFilter === 'send' ? 'active' : '',
                        onClick: () => {
                            setTypeFilter('send');
                            setCurrentPageNum(1);
                        }
                    }, language === 'en' ? 'Out' : '')
                ),
                React.createElement('div', {
                        className: "transactions-controls"
                    },
                    React.createElement('input', {
                        type: "text",
                        placeholder: language === 'en' ? "Search description, amount..." : "   ...",
                        value: searchTerm,
                        onChange: e => {
                            setSearchTerm(e.target.value);
                            setCurrentPageNum(1);
                        }
                    }),
                    React.createElement('div', {
                            className: "filters-sort-group"
                        },
                        React.createElement(CustomSelect, {
                            options: sortOptions,
                            value: sortBy,
                            onChange: e => {
                                setSortBy(e.target.value);
                                setCurrentPageNum(1);
                            },
                            language: language,
                            placeholderText: language === 'en' ? 'Sort by...' : ' ...'
                        })
                    )
                ),
                React.createElement('div', {
                        className: "transactions-list-wrapper"
                    },
                    React.createElement('div', {
                            className: "transactions-list"
                        },
                        currentPagedTransactions.length === 0 ?
                        React.createElement('div', {
                                className: "no-transactions"
                            },
                            React.createElement(IconNoData, null),
                            language === 'en' ? 'No transactions match filters' : '      '
                        ) :
                        currentPagedTransactions.map((t) =>
                            React.createElement('div', {
                                    className: "transaction",
                                    key: t.timestamp
                                },
                                React.createElement('div', {
                                        className: "transaction-details"
                                    },
                                    React.createElement('div', {
                                        className: `transaction-description ${language === 'ur' ? 'rtl-text' : ''}`
                                    }, t.description),
                                    React.createElement('div', {
                                            className: "transaction-meta"
                                        },
                                        formatDate(t.timestamp), " | ", React.createElement('span', {
                                            className: `type ${t.type === 'receive' ? 'in' : 'out'}`
                                        }, language === 'en' ? (t.type === 'receive' ? 'In' : 'Out') : (t.type === 'receive' ? '' : ''))
                                    )
                                ),
                                React.createElement('div', {
                                        className: "transaction-info"
                                    },
                                    React.createElement('div', {
                                        className: `transaction-amount-value ${t.type === 'receive' ? 'in' : 'out'}`
                                    }, "Rs ", Math.abs(t.amount).toFixed(2)),
                                    React.createElement('div', {
                                            className: "transaction-action-buttons"
                                        },
                                        React.createElement('button', {
                                            className: "edit-btn",
                                            onClick: () => onEditTransaction(t),
                                            "aria-label": language === 'en' ? 'Edit transaction' : '    '
                                        }, React.createElement(IconPencil, null)),
                                        React.createElement('button', {
                                            className: "delete-btn",
                                            onClick: () => onDeleteConfirm(t),
                                            "aria-label": language === 'en' ? 'Delete transaction' : '   '
                                        }, React.createElement(IconTrash, null))
                                    )
                                )
                            )
                        )
                    ),
                    totalPages > 1 && React.createElement('div', {
                            className: "pagination-controls"
                        },
                        React.createElement('button', {
                                onClick: () => paginate(currentPageNum - 1),
                                disabled: currentPageNum === 1
                            },
                            language === 'en' ? 'Previous' : ''
                        ),
                        React.createElement('span', null, language === 'en' ? `Page ${currentPageNum} of ${totalPages}` : ` ${currentPageNum}  ${totalPages}`),
                        React.createElement('button', {
                                onClick: () => paginate(currentPageNum + 1),
                                disabled: currentPageNum === totalPages
                            },
                            language === 'en' ? 'Next' : ''
                        )
                    )
                )
            );
        }

        function EditTransactionForm({
            transaction,
            onSave,
            onCancel,
            language,
            showNotification
        }) {
            const [currentAmount, setCurrentAmount] = useState('');
            const [currentDescription, setCurrentDescription] = useState('');

            useEffect(() => {
                if (transaction) {
                    setCurrentAmount(Math.abs(transaction.amount).toString());
                    setCurrentDescription(transaction.description);
                }
            }, [transaction]);

            const handleSave = () => {
                if (!currentAmount || isNaN(currentAmount) || Number(currentAmount) <= 0) {
                    showNotification(language === 'en' ? 'Please enter a valid positive amount.' : '       ', 'error');
                    return;
                }
                if (!currentDescription.trim()) {
                    showNotification(language === 'en' ? 'Description cannot be empty.' : '    ', 'error');
                    return;
                }
                const finalAmount = transaction.type === 'send' ? -Math.abs(Number(currentAmount)) : Math.abs(Number(currentAmount));
                onSave({...transaction,
                    amount: finalAmount,
                    description: currentDescription.trim()
                });
            };

            if (!transaction) return null;

            return React.createElement('div', {
                    className: "edit-transaction-form"
                },
                React.createElement('div', null,
                    React.createElement('label', {
                        htmlFor: "editAmount"
                    }, language === 'en' ? 'Amount' : ''),
                    React.createElement('input', {
                        type: "number",
                        id: "editAmount",
                        value: currentAmount,
                        onChange: (e) => setCurrentAmount(e.target.value),
                        placeholder: language === 'en' ? 'Enter amount' : '  ',
                        inputMode: "decimal"
                    })
                ),
                React.createElement('div', null,
                    React.createElement('label', {
                        htmlFor: "editDescription"
                    }, language === 'en' ? 'Description' : ''),
                    React.createElement('input', {
                        type: "text",
                        id: "editDescription",
                        value: currentDescription,
                        onChange: (e) => setCurrentDescription(e.target.value),
                        placeholder: language === 'en' ? 'Enter description' : '  ',
                        style: {
                            direction: language === 'ur' ? 'rtl' : 'ltr'
                        }
                    })
                ),
                React.createElement('div', {
                        className: "transaction-type-display"
                    },
                    language === 'en' ? 'Type: ' : ': ',
                    React.createElement('strong', null,
                        transaction.type === 'receive' ?
                        (language === 'en' ? 'In' : '') :
                        (language === 'en' ? 'Out' : '')
                    ),
                    React.createElement('small', null, " (", language === 'en' ? 'Type cannot be changed' : '     ', ")")
                ),
                React.createElement('div', {
                        className: "modal-actions"
                    },
                    React.createElement('button', {
                            type: "button",
                            className: "cancel-btn",
                            onClick: onCancel
                        },
                        language === 'en' ? 'Cancel' : ' '
                    ),
                    React.createElement('button', {
                            type: "button",
                            className: "save-btn",
                            onClick: handleSave
                        },
                        language === 'en' ? 'Save Changes' : '  '
                    )
                )
            );
        }

        function WelcomeOverlay({
            language,
            onDismiss
        }) {
            const [isFadingOut, setIsFadingOut] = useState(false);
            const handleDismiss = () => {
                setIsFadingOut(true);
                setTimeout(onDismiss, 300);
            };

            return React.createElement('div', {
                    className: `welcome-overlay ${isFadingOut ? 'fading-out' : ''}`,
                    onClick: handleDismiss
                },
                React.createElement('div', {
                        className: "welcome-message-box",
                        onClick: (e) => e.stopPropagation()
                    },
                    React.createElement('h2', null, language === 'en' ? 'Welcome to Spend Wise!' : '    !'),
                    React.createElement('p', null,
                        language === 'en' ?
                        'Easily track your income and expenses, view summaries, and export your financial data. Let\'s manage your money wisely!' :
                        '                        !'
                    ),
                    React.createElement('button', {
                            onClick: handleDismiss
                        },
                        language === 'en' ? 'Got it!' : ' !'
                    )
                )
            );
        }

        function ImagePreviewPage({
            language,
            onBack,
            imagePagesData,
            onImageShare,
            showNotification
        }) {
            const [currentImageIndex, setCurrentImageIndex] = useState(0);
            const [animationDirection, setAnimationDirection] = useState('next'); // 'next' or 'prev'

            useEffect(() => {
                return () => {
                    if (imagePagesData) {
                        imagePagesData.forEach(imgData => {
                            if (imgData.imageUrl && imgData.imageUrl.startsWith('blob:')) {
                                URL.revokeObjectURL(imgData.imageUrl);
                            }
                        });
                    }
                };
            }, [imagePagesData]);

            const handleNext = () => {
                if (currentImageIndex < imagePagesData.length - 1) {
                    setAnimationDirection('next');
                    setCurrentImageIndex(prev => prev + 1);
                }
            };

            const handlePrev = () => {
                if (currentImageIndex > 0) {
                    setAnimationDirection('prev');
                    setCurrentImageIndex(prev => prev - 1);
                }
            };

            const handleDoubleClick = () => {
                if (imagePagesData && imagePagesData.length > 0) {
                    onImageShare(imagePagesData);
                } else {
                    showNotification(language === 'en' ? 'Cannot share report: data missing.' : '     :   ', 'error');
                }
            };

            const currentImageData = imagePagesData && imagePagesData.length > 0 ? imagePagesData[currentImageIndex] : null;

            if (!currentImageData) {
                return React.createElement('div', {
                        className: "image-preview-page"
                    },
                    React.createElement('header', null,
                        React.createElement('button', {
                            className: "back-button header-icon-btn",
                            onClick: onBack,
                            "aria-label": language === 'en' ? "Go back" : " "
                        }, React.createElement(IconArrowLeft, null)),
                        React.createElement('h1', null, language === 'en' ? 'Report Preview' : '   '),
                        React.createElement('div', {
                            style: {
                                width: '38px',
                                height: '38px',
                                flexShrink: 0
                            }
                        }) // Placeholder
                    ),
                    React.createElement('div', {
                            className: "image-preview-content"
                        },
                        React.createElement('p', null, language === 'en' ? 'No image to display or report failed to load.' : '            ')
                    )
                );
            }

            const totalImages = imagePagesData.length;
            const animationClass = animationDirection === 'next' ? 'slideInFromRight' : 'slideInFromLeft';

            return React.createElement('div', {
                    className: "image-preview-page"
                },
                React.createElement('header', null,
                    React.createElement('button', {
                        className: "back-button header-icon-btn",
                        onClick: onBack,
                        "aria-label": language === 'en' ? "Go back" : " "
                    }, React.createElement(IconArrowLeft, null)),
                    React.createElement('h1', null, language === 'en' ? `Report Preview` : `   `),
                    React.createElement('div', {
                        style: {
                            width: '38px',
                            height: '38px',
                            flexShrink: 0
                        }
                    }) // Placeholder
                ),
                React.createElement('div', {
                        className: "image-preview-content"
                    },
                    React.createElement('div', {
                            key: currentImageIndex, // Key re-triggers animation on change
                            className: `image-wrapper ${animationClass}`,
                            onDoubleClick: handleDoubleClick
                        },
                        React.createElement('img', {
                            src: currentImageData.imageUrl,
                            alt: `${language === 'en' ? 'Transaction Report Preview' : '      '} - ${currentImageData.fileName}`
                        })
                    ),
                    totalImages > 1 && React.createElement('div', {
                            className: 'image-preview-nav'
                        },
                        React.createElement('button', {
                                onClick: handlePrev,
                                disabled: currentImageIndex === 0
                            },
                            React.createElement(IconChevronLeft, null), language === 'en' ? 'Prev' : ''
                        ),
                        React.createElement('span', {
                            className: 'image-preview-page-indicator'
                        }, `${currentImageIndex + 1} / ${totalImages}`),
                        React.createElement('button', {
                                onClick: handleNext,
                                disabled: currentImageIndex === totalImages - 1
                            },
                            language === 'en' ? 'Next' : '', React.createElement(IconChevronRight, null)
                        )
                    ),
                    React.createElement('p', {
                            style: {
                                fontSize: '0.8rem',
                                color: 'var(--tx-meta-color)',
                                marginTop: '5px'
                            }
                        },
                        language === 'en' ? 'Double-tap image to share all pages.' : '          '
                    )
                )
            );
        }

        function SideMenu({
            isOpen,
            onClose,
            language,
            onNavigate,
            onToggleTheme,
            currentTheme
        }) {
            const menuRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target)) {
                        const hamburgerButton = document.querySelector('.hamburger-menu-btn');
                        if (hamburgerButton && hamburgerButton.contains(event.target)) {
                            return;
                        }
                        onClose();
                    }
                };
                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                }
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [isOpen, onClose]);


            const handleNavigation = (targetPage) => {
                onNavigate(targetPage);
                onClose();
            };

            const handleThemeToggle = () => {
                onToggleTheme();
            }

            return React.createElement(Fragment, null,
                React.createElement('div', {
                    className: `side-menu-overlay ${isOpen ? 'open' : ''}`,
                    onClick: onClose
                }),
                React.createElement('div', {
                        ref: menuRef,
                        className: `side-menu ${isOpen ? 'open' : ''} ${language === 'ur' ? 'rtl' : ''}`
                    },
                    React.createElement('div', {
                            className: "side-menu-header"
                        },
                        React.createElement('h3', null, "SPEND WISE")
                    ),
                    React.createElement('ul', {
                            className: "side-menu-list"
                        },
                        React.createElement('li', {
                                className: "side-menu-item",
                                onClick: () => handleNavigation('profile'),
                                role: "button",
                                tabIndex: 0
                            },
                            React.createElement('span', null, language === 'en' ? 'Profile & Settings' : '  ')
                        ),
                        React.createElement('li', {
                                className: "side-menu-item",
                                onClick: handleThemeToggle,
                                role: "button",
                                tabIndex: 0
                            },
                            React.createElement('span', null, language === 'en' ? `Switch to ${currentTheme === 'light' ? 'Dark' : 'Light'} Theme` : `${currentTheme === 'light' ? '' : ''}    `)
                        ),
                        React.createElement('li', {
                                className: "side-menu-item",
                                onClick: () => handleNavigation('language'),
                                role: "button",
                                tabIndex: 0
                            },
                            React.createElement('span', null, language === 'en' ? 'Language' : '')
                        ),
                        React.createElement('li', {
                                className: "side-menu-item",
                                onClick: () => handleNavigation('userManual'),
                                role: "button",
                                tabIndex: 0
                            },
                            React.createElement('span', null, language === 'en' ? 'User Manual' : ' ')
                        ),
                        React.createElement('li', {
                                className: "side-menu-item",
                                onClick: () => handleNavigation('privacyPolicy'),
                                role: "button",
                                tabIndex: 0
                            },
                            React.createElement('span', null, language === 'en' ? 'Privacy Policy' : '  ')
                        )
                    )
                )
            );
        }

        function CalculatorModal({
            isOpen,
            onClose,
            language
        }) {
            const [input, setInput] = useState('');
            const [result, setResult] = useState('');

            const handleButtonClick = (value) => {
                if (value === 'C') {
                    setInput('');
                    setResult('');
                } else if (value === 'DEL') {
                    setInput(prev => prev.slice(0, -1));
                } else if (value === '=') {
                    if (input === '') return;
                    try {
                        // Sanitize input to allow only valid characters for calculation
                        const sanitizedInput = input.replace(/[^-()\d/*+.]/g, '');
                        // Using Function constructor as a safer alternative to eval()
                        const calculatedResult = new Function('return ' + sanitizedInput)();
                        setResult(calculatedResult.toString());
                        setInput(calculatedResult.toString());
                    } catch (error) {
                        setResult(language === 'en' ? 'Error' : '');
                        setInput('');
                    }
                } else {
                    // If there's a result and user types a number (not operator), start new calculation
                    if (result !== '' && !['+', '-', '*', '/'].includes(value) && !['+', '-', '*', '/'].includes(input.slice(-1))) {
                        setInput(value);
                        setResult('');
                    } else {
                        setInput(prev => prev + value);
                    }
                }
            };

            const buttons = [
                'C', 'DEL', '/', '*',
                '7', '8', '9', '-',
                '4', '5', '6', '+',
                '1', '2', '3',
                '0', '.', '='
            ];

            return React.createElement(Modal, {
                    isOpen: isOpen,
                    onClose: onClose,
                    title: language === 'en' ? "Calculator" : "",
                    language: language,
                    isSingleAction: true,
                    contentClassName: "calculator-modal-content",
                    customActions: React.createElement('div', {
                            className: "modal-actions"
                        },
                        React.createElement('button', {
                            className: "close-modal-btn",
                            onClick: onClose
                        }, language === 'en' ? 'Close' : ' ')
                    )
                },
                React.createElement('div', null,
                    React.createElement('div', {
                            className: "calculator-display"
                        },
                        React.createElement('div', {
                            className: 'result'
                        }, result),
                        input || '0'
                    ),
                    React.createElement('div', {
                            className: "calculator-buttons"
                        },
                        buttons.map(btn => {
                            let className = '';
                            if (['/', '*', '-', '+'].includes(btn)) className = 'operator';
                            if (['C', 'DEL'].includes(btn)) className = 'function';
                            if (btn === '=') className = 'equals';

                            return React.createElement('button', {
                                key: btn,
                                className: className,
                                onClick: () => handleButtonClick(btn)
                            }, btn)
                        })
                    )
                )
            );
        }


        // --- Main App Component ---
        function App() {
            const [transactions, setTransactions] = useState([]);
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');
            const [language, setLanguage] = useState('en');
            const [theme, setTheme] = useState('light');
            const [isListening, setIsListening] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [currentPage, setCurrentPage] = useState('main');
            const [transactionType, setTransactionType] = useState(null);
            const [dropdownOpen, setDropdownOpen] = useState(false);
            const [message, setMessage] = useState(null);
            const languages = [{
                code: 'en',
                name: 'English',
                flag: 'https://flagcdn.com/w20/gb.png'
            }, {
                code: 'ur',
                name: '',
                flag: 'https://flagcdn.com/w20/pk.png'
            }];

            const [organizationName, setOrganizationName] = useState('');
            const [personalName, setPersonalName] = useState('');
            const [showWelcomeMessage, setShowWelcomeMessage] = useState(false);
            const [showVoicePermPreDialog, setShowVoicePermPreDialog] = useState(false);
            const [initialLanguageChosen, setInitialLanguageChosen] = useState(false);

            const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
            const [transactionToDelete, setTransactionToDelete] = useState(null);
            const [isDeleteAllModalOpen, setIsDeleteAllModalOpen] = useState(false);
            const [isEditModalOpen, setIsEditModalOpen] = useState(false);
            const [transactionToEdit, setTransactionToEdit] = useState(null);
            const [showUserManualModal, setShowUserManualModal] = useState(false);
            const [isPrivacyPolicyOpen, setIsPrivacyPolicyOpen] = useState(false);
            const [isLanguageModalOpen, setIsLanguageModalOpen] = useState(false);
            const [isSideMenuOpen, setIsSideMenuOpen] = useState(false);
            const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);

            const [reportImagePages, setReportImagePages] = useState([]);

            const [isOffline, setIsOffline] = useState(false);
            const [showOfflinePageOnStartup, setShowOfflinePageOnStartup] = useState(false);

            const initialSetupDoneRef = useRef(false);
            initialSetupDoneRef.current = !!localStorage.getItem('organizationName_v7');

            const canInteractWithApp = initialSetupDoneRef.current || organizationName.trim() !== '';

            useEffect(() => {
                console.log("App.js: Main setup useEffect.");
                let backButtonListenerAttached = false;
                let onlineListenerAttached = false;
                let offlineListenerAttached = false;

                const initializeCordovaVisuals = (currentTheme) => {
                    console.log("App.js: Initializing Cordova visual features for theme:", currentTheme);
                    if (window.StatusBar) {
                        StatusBar.styleLightContent();
                    } else {
                        console.warn("App.js: StatusBar plugin not found.");
                    }
                };

                const handleOnlineStatus = () => {
                    setIsOffline(false);
                    setShowOfflinePageOnStartup(false);
                    if (message && message.text && message.text.toLowerCase().includes('offline')) {
                        setMessage(null);
                    }
                    showNotification(language === 'en' ? 'Back online.' : '  ', 'success', 2000);
                    console.log("App Connection: Online");
                };

                const handleOfflineStatus = () => {
                    setIsOffline(true);
                    const currentInitialSetupDone = !!localStorage.getItem('organizationName_v7');
                    if (!currentInitialSetupDone) {
                        setShowOfflinePageOnStartup(true);
                    } else if (currentPage !== 'offlinePageOnInit') {
                        showNotification(language === 'en' ? 'You are offline. Changes are saved locally.' : '         ', 'info', 5000);
                    }
                    console.log("App Connection: Offline");
                };

                const loadApplicationDataAndSettings = async() => {
                    console.log("App.js: Loading application data and settings.");

                    const storedInitialLangChoice = localStorage.getItem('initialLanguageChosen_v7');
                    if (storedInitialLangChoice) setInitialLanguageChosen(true);

                    const orgNameFromStorage = localStorage.getItem('organizationName_v7') || '';
                    setOrganizationName(orgNameFromStorage);
                    setPersonalName(localStorage.getItem('personalName_v7') || '');
                    initialSetupDoneRef.current = !!orgNameFromStorage;

                    const storedLang = localStorage.getItem('appLanguage_v7') || 'en';
                    setLanguage(storedLang);

                    const storedTheme = localStorage.getItem('appTheme_v7') || 'light';
                    setTheme(storedTheme);

                    if (orgNameFromStorage) {
                        try {
                            const dbTransactions = await getAllTransactionsDB();
                            setTransactions(dbTransactions);
                        } catch (error) {
                            console.error("App.js: Failed to load transactions:", error);
                            const currentLangForError = localStorage.getItem('appLanguage_v7') || 'en';
                            showNotification(currentLangForError === 'en' ? 'Error loading transactions.' : '     ', 'error');
                        }
                        if (!localStorage.getItem('welcomeMessageShown_v7')) {
                            setShowWelcomeMessage(true);
                        }
                    }
                    return storedTheme;
                };

                const onAppDeviceReadyHandler = async() => {
                    console.log("App.js: 'deviceready' handled by App component.");

                    const currentSetupDone = !!localStorage.getItem('organizationName_v7');
                    if (window.cordova && navigator.connection) {
                        const networkState = navigator.connection.type;
                        if (networkState === Connection.NONE) {
                            console.log("App.js: Initial state is OFFLINE.");
                            setIsOffline(true);
                            if (!currentSetupDone) setShowOfflinePageOnStartup(true);
                        } else {
                            console.log("App.js: Initial state is ONLINE.");
                            setIsOffline(false);
                            setShowOfflinePageOnStartup(false);
                        }
                    } else {
                        console.warn("App.js: Network information plugin not available. Assuming online status based on browser.");
                        const isNavOffline = navigator.onLine === false;
                        setIsOffline(isNavOffline);
                        if (isNavOffline && !currentSetupDone) setShowOfflinePageOnStartup(true);
                    }

                    const currentLoadedTheme = await loadApplicationDataAndSettings();
                    initializeCordovaVisuals(currentLoadedTheme);

                    if (window.cordova && navigator.splashscreen) {
                        navigator.splashscreen.hide();
                        console.log("App.js: Native splash screen hidden after app logic ready.");
                    } else {
                        console.warn("App.js: Cordova splashscreen plugin not found.");
                    }

                    if (!backButtonListenerAttached && window.cordova) {
                        document.addEventListener("backbutton", handleBackButton, false);
                        backButtonListenerAttached = true;
                        console.log("App.js: Back button listener added.");
                    }

                    if (!onlineListenerAttached) {
                        document.addEventListener("online", handleOnlineStatus, false);
                        onlineListenerAttached = true;
                    }
                    if (!offlineListenerAttached) {
                        document.addEventListener("offline", handleOfflineStatus, false);
                        offlineListenerAttached = true;
                    }
                };

                if (window.cordova) {
                    console.log("App.js: Cordova environment detected.");
                    if (window.actualDeviceIsReady) {
                        console.log("App.js: Device was already ready, running App's setup.");
                        onAppDeviceReadyHandler();
                    } else {
                        console.log("App.js: App component waiting for 'deviceready'.");
                        document.addEventListener('deviceready', onAppDeviceReadyHandler, false);
                    }
                } else {
                    console.warn("App.js: Cordova NOT detected. Running browser/fallback setup.");
                    onAppDeviceReadyHandler(); // Run handler for browser as well
                    window.addEventListener('online', handleOnlineStatus);
                    window.addEventListener('offline', handleOfflineStatus);
                }

                return () => {
                    console.log("App.js: Cleanup function running.");
                    document.removeEventListener('deviceready', onAppDeviceReadyHandler, false);
                    if (backButtonListenerAttached) {
                        document.removeEventListener("backbutton", handleBackButton, false);
                    }
                    window.removeEventListener('online', handleOnlineStatus);
                    window.removeEventListener('offline', handleOfflineStatus);
                    document.removeEventListener("online", handleOnlineStatus, false);
                    document.removeEventListener("offline", handleOfflineStatus, false);
                };
            }, []);

            useEffect(() => {
                console.log("App.js: Theme effect. Current theme:", theme);
                document.body.classList.remove('theme-light', 'theme-dark');
                document.body.classList.add(`theme-${theme}`);
                localStorage.setItem('appTheme_v7', theme);
            }, [theme]);

            useEffect(() => {
                console.log("App.js: Language effect. Current language:", language);
                document.documentElement.lang = language;
                document.documentElement.dir = language === 'ur' ? 'rtl' : 'ltr';
                localStorage.setItem('appLanguage_v7', language);
            }, [language]);

            useEffect(() => {
                if (organizationName) {
                    localStorage.setItem('organizationName_v7', organizationName);
                    initialSetupDoneRef.current = true;
                } else {
                    localStorage.removeItem('organizationName_v7');
                    initialSetupDoneRef.current = false;
                }
            }, [organizationName]);
            useEffect(() => {
                if (personalName) localStorage.setItem('personalName_v7', personalName);
                else localStorage.removeItem('personalName_v7');
            }, [personalName]);

            const showNotification = (text, type = 'info', duration = 3000) => {
                setMessage({
                    text,
                    type
                });
                if (duration) setTimeout(() => setMessage(null), duration);
            };

            const handleBackButton = (e) => {
                e.preventDefault();
                console.log("Back button pressed. Current page:", currentPage, "Modals:", isDeleteModalOpen, isEditModalOpen, showUserManualModal, isSideMenuOpen);
                if (isCalculatorOpen) {
                    setIsCalculatorOpen(false);
                    return;
                }
                if (isSideMenuOpen) {
                    setIsSideMenuOpen(false);
                    return;
                }
                if (isDeleteModalOpen) {
                    setIsDeleteModalOpen(false);
                    setTransactionToDelete(null);
                    return;
                }
                if (isDeleteAllModalOpen) {
                    setIsDeleteAllModalOpen(false);
                    return;
                }
                if (isEditModalOpen) {
                    setIsEditModalOpen(false);
                    setTransactionToEdit(null);
                    return;
                }
                if (showUserManualModal) {
                    setShowUserManualModal(false);
                    return;
                }
                if (isPrivacyPolicyOpen) {
                    setIsPrivacyPolicyOpen(false);
                    return;
                }
                if (isLanguageModalOpen) {
                    setIsLanguageModalOpen(false);
                    return;
                }
                if (showVoicePermPreDialog) {
                    setShowVoicePermPreDialog(false);
                    return;
                }
                if (dropdownOpen) {
                    setDropdownOpen(false);
                    return;
                }

                if (currentPage === 'imagePreview') setCurrentPage('main');
                else if (currentPage === 'transactions' || currentPage === 'profile') setCurrentPage('main');
                else if (currentPage === 'main' && initialSetupDoneRef.current && initialLanguageChosen) {
                    if (navigator.app && navigator.app.exitApp) {
                        if (window.backButtonExitPressedOnceApp) {
                            navigator.app.exitApp();
                        } else {
                            window.backButtonExitPressedOnceApp = true;
                            showNotification(language === 'en' ? 'Press back again to exit' : '      ', 'info', 2000);
                            setTimeout(() => {
                                window.backButtonExitPressedOnceApp = false;
                            }, 2000);
                        }
                    } else console.warn("navigator.app.exitApp not available.");
                } else if ((!initialSetupDoneRef.current || !initialLanguageChosen) && !showOfflinePageOnStartup) {
                    if (navigator.app && navigator.app.exitApp) navigator.app.exitApp();
                } else if (showOfflinePageOnStartup) {
                    if (navigator.app && navigator.app.exitApp) navigator.app.exitApp();
                } else console.log("Back button: No specific action.");
            };

            const handleInitialLanguageSelect = (langCode) => {
                selectLanguage(langCode, false); // select language without showing notification
                setInitialLanguageChosen(true);
                localStorage.setItem('initialLanguageChosen_v7', 'true');
            };

            const handleSaveInitialSetup = (data) => {
                setOrganizationName(data.orgName);
                setPersonalName(data.personalName);
                initialSetupDoneRef.current = true;
                setShowOfflinePageOnStartup(false);
                showNotification(language === 'en' ? 'Setup complete! Welcome!' : '  !  !', 'success');
                if (!localStorage.getItem('welcomeMessageShown_v7')) setShowWelcomeMessage(true);
            };

            const handleSaveProfile = (data) => {
                return new Promise((resolve) => {
                    setPersonalName(data.personalName);
                    setOrganizationName(data.orgName);
                    showNotification(language === 'en' ? 'Profile saved successfully!' : '    !', 'success');
                    setCurrentPage('main');
                    resolve();
                });
            };

            const receivedTotal = transactions.filter(t => t.type === 'receive').reduce((sum, t) => sum + Number(t.amount), 0);
            const sentTotal = transactions.filter(t => t.type === 'send').reduce((sum, t) => sum + Number(t.amount), 0);
            const netBalance = receivedTotal + sentTotal;

            const addTransaction = async() => {
                if (!initialSetupDoneRef.current) {
                    showNotification(language === 'en' ? 'Please set an organization name first (via Profile & Settings).' : '        (/  )', 'error');
                    return;
                }
                if (!transactionType) {
                    showNotification(language === 'en' ? 'Select type (In/Out)' : '   (/)', 'error');
                    return;
                }
                if (!amount || isNaN(amount) || Number(amount) <= 0 || !description.trim()) {
                    showNotification(language === 'en' ? 'Enter valid positive amount & non-empty details' : '        ', 'error');
                    return;
                }
                setIsProcessing(true);
                const newTransaction = {
                    amount: transactionType === 'send' ? -Math.abs(Number(amount)) : Math.abs(Number(amount)),
                    description: description.trim(),
                    type: transactionType,
                    timestamp: Date.now()
                };
                try {
                    await addTransactionDB(newTransaction);
                    setTransactions(prev => [newTransaction, ...prev].sort((a, b) => b.timestamp - a.timestamp));
                    setAmount('');
                    setDescription('');
                    setTransactionType(null);
                    const successMsg = language === 'en' ? 'Transaction added!' : '    !';
                    const offlineSuccessMsg = language === 'en' ? 'Transaction saved locally!' : '       !';
                    showNotification(isOffline ? offlineSuccessMsg : successMsg, 'success');
                } catch (error) {
                    showNotification(language === 'en' ? 'Error saving transaction.' : '     ', 'error');
                } finally {
                    setIsProcessing(false);
                }
            };

            const confirmDeleteTransaction = (transaction) => {
                setTransactionToDelete(transaction);
                setIsDeleteModalOpen(true);
            };
            const executeDeleteTransaction = async() => {
                if (!transactionToDelete) return;
                try {
                    await deleteTransactionDB(transactionToDelete.timestamp);
                    setTransactions(prev => prev.filter(t => t.timestamp !== transactionToDelete.timestamp));
                    showNotification(language === 'en' ? 'Transaction deleted' : '    ', 'info');
                } catch (error) {
                    showNotification(language === 'en' ? 'Error deleting transaction.' : '     ', 'error');
                } finally {
                    setIsDeleteModalOpen(false);
                    setTransactionToDelete(null);
                }
            };

            const confirmDeleteAllTransactions = () => {
                setIsDeleteAllModalOpen(true);
            };
            const executeDeleteAllTransactions = async() => {
                try {
                    await deleteAllTransactionsDB();
                    setTransactions([]);
                    showNotification(language === 'en' ? 'All transactions deleted successfully.' : '      ', 'success');
                } catch (error) {
                    showNotification(language === 'en' ? 'Error deleting all transactions.' : '      ', 'error');
                } finally {
                    setIsDeleteAllModalOpen(false);
                }
            };

            const openEditModal = (transaction) => {
                setTransactionToEdit(transaction);
                setIsEditModalOpen(true);
            };
            const handleSaveEditedTransaction = async(editedTransactionData) => {
                try {
                    await updateTransactionDB(editedTransactionData);
                    setTransactions(prev => prev.map(t => t.timestamp === editedTransactionData.timestamp ? editedTransactionData : t).sort((a, b) => b.timestamp - a.timestamp));
                    setIsEditModalOpen(false);
                    setTransactionToEdit(null);
                    showNotification(language === 'en' ? 'Transaction updated!' : '     !', 'success');
                } catch (error) {
                    showNotification(language === 'en' ? 'Error updating transaction.' : '      ', 'error');
                }
            };

            const listenCordova = () => {
                const speech = cordova.plugins.speechRecognition;
                setIsListening(true);
                showNotification(language === 'en' ? 'Listening...' : '  ...', 'info', null);
                speech.startListening(
                    matches => {
                        setMessage(null);
                        if (matches && matches.length > 0) {
                            setDescription(prev => (prev ? prev.trim() + ' ' : '') + matches[0].trim());
                            showNotification(language === 'en' ? 'Voice captured!' : ' !', 'success');
                        }
                        setIsListening(false);
                    },
                    error => {
                        setMessage(null);
                        console.error('Cordova speech error:', error);
                        let msg = language === 'en' ? "Voice input failed." : "   ";
                        if (error === "      " || error === "No match") msg = language === 'en' ? "No speech detected or service unavailable." : "       ";
                        else if (error === "     " || error === "Missing permission") msg = language === 'en' ? "Microphone permission needed." : "    ";
                        showNotification(msg, 'error', 7000);
                        setIsListening(false);
                    }, {
                        language: language === 'en' ? 'en-US' : 'ur-PK',
                        matches: 1,
                        showPartial: false
                    }
                );
            };

            const requestCordovaMicPermission = (callback) => {
                if (window.cordova && cordova.plugins && cordova.plugins.speechRecognition) {
                    cordova.plugins.speechRecognition.requestPermission(
                        () => {
                            showNotification(language === 'en' ? 'Microphone access granted!' : '    !', 'success');
                            if (callback) callback(true);
                        },
                        () => {
                            showNotification(language === 'en' ? 'Microphone access denied.' : '     ', 'error');
                            if (callback) callback(false);
                        }
                    );
                } else if (callback) {
                    callback(false); // No plugin, can't grant
                }
            };

            const startVoiceInput = () => {
                if (isOffline) {
                    showNotification(language === 'en' ? 'Voice input requires an internet connection.' : '        ', 'info');
                    return;
                }

                if (window.cordova && cordova.plugins && cordova.plugins.speechRecognition) {
                    const speech = cordova.plugins.speechRecognition;
                    speech.hasPermission(
                        (hasPerm) => {
                            if (hasPerm) {
                                listenCordova();
                            } else {
                                if (!localStorage.getItem('voicePermissionPreDialogShown_v7')) {
                                    setShowVoicePermPreDialog(true);
                                } else {
                                    requestCordovaMicPermission((granted) => {
                                        if (granted) listenCordova();
                                    });
                                }
                            }
                        },
                        (err) => {
                            console.error("Speech perm check err:", err);
                            showNotification(language === 'en' ? 'Mic perm check error.' : '    ', 'error');
                            setIsListening(false);
                        }
                    );
                } else if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { // Web fallback
                    const SpeechAPI = window.SpeechRecognition || window.webkitSpeechRecognition,
                        rec = new SpeechAPI();
                    rec.lang = language === 'en' ? 'en-US' : 'ur-PK';
                    rec.interimResults = false;
                    rec.maxAlternatives = 1;
                    rec.onstart = () => {
                        setIsListening(true);
                        showNotification(language === 'en' ? 'Listening...' : '  ...', 'info', null);
                    };
                    rec.onresult = e => {
                        setMessage(null);
                        setDescription(p => (p ? p.trim() + ' ' : '') + e.results[0][0].transcript.trim());
                        showNotification(language === 'en' ? 'Voice captured!' : ' !', 'success');
                    };
                    rec.onerror = e => {
                        setMessage(null);
                        console.error('Web Speech API error:', e.error);
                        showNotification(language === 'en' ? `Voice error: ${e.error}` : `  : ${e.error}`, 'error');
                    };
                    rec.onend = () => {
                        setIsListening(false);
                        if (message && message.type === 'info' && message.text.startsWith(language === 'en' ? 'Listening' : '  ')) setMessage(null);
                    };
                    try {
                        rec.start();
                    } catch (e) {
                        console.error("Web Speech API start error:", e);
                        setIsListening(false);
                        showNotification(language === 'en' ? 'Could not start voice.' : '   ', 'error');
                    }
                } else {
                    showNotification(language === 'en' ? 'Voice input not supported.' : '   ', 'error');
                    setIsListening(false);
                }
            };

            const handleVoicePermPreDialogAllow = () => {
                setShowVoicePermPreDialog(false);
                localStorage.setItem('voicePermissionPreDialogShown_v7', 'true');
                requestCordovaMicPermission((granted) => {
                    if (granted) {
                        setTimeout(listenCordova, 250);
                    }
                });
            };
            const handleVoicePermPreDialogDeny = () => {
                setShowVoicePermPreDialog(false);
                localStorage.setItem('voicePermissionPreDialogShown_v7', 'true');
                showNotification(language === 'en' ? 'Voice input disabled. You can grant permission via system settings or the next time you tap the mic.' : '                    ', 'info', 4000);
            };


            const generateReportImageData = useCallback((txsForPage, periodTitle, currentOrgNameForExport, currentPersonalNameForExport, langForExport, exportFileNamePrefix, pageNum, totalPages, includeSummary = false, fullReportTotals) => {
                return new Promise((resolvePromise, rejectPromise) => {
                    const el = document.createElement('div');
                    el.className = 'export-element';
                    if (window.innerWidth < 768 || (window.screen && window.screen.width < 768)) {
                        el.classList.add('compact-view');
                    }
                    if (langForExport === 'ur') {
                        el.classList.add('rtl');
                    }

                    let tableHtml;
                    if (langForExport === 'ur') {
                        const headers = `<th>${''}</th><th>${''}</th><th class="description-cell">${''}</th><th>${'/'}</th>`;
                        const rows = txsForPage.map(t => `<tr>
                    <td class="amount-cell ${t.type === 'receive' ? 'in-amount' : 'out-amount'}">Rs ${Math.abs(t.amount).toFixed(2)}</td>
                    <td class="export-type ${t.type === 'receive' ? 'in' : 'out'}">${t.type === 'receive' ? '' : ''}</td>
                    <td class="description-cell">${t.description}</td>
                    <td>${new Date(t.timestamp).toLocaleString('ur-PK', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</td>
                </tr>`).join('');
                        tableHtml = `<table class="export-table"><thead><tr>${headers}</tr></thead><tbody>${rows}</tbody></table>`;
                    } else { // English LTR
                        const headers = `<th>${'Date & Time'}</th><th class="description-cell">${'Details'}</th><th>${'Type'}</th><th class="amount-cell">${'Amount'}</th>`;
                        const rows = txsForPage.map(t => `<tr>
                    <td>${new Date(t.timestamp).toLocaleString('en-US', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</td>
                    <td class="description-cell">${t.description}</td>
                    <td class="export-type ${t.type === 'receive' ? 'in' : 'out'}">${t.type === 'receive' ? 'In' : 'Out'}</td>
                    <td class="amount-cell ${t.type === 'receive' ? 'in-amount' : 'out-amount'}">Rs ${Math.abs(t.amount).toFixed(2)}</td>
                </tr>`).join('');
                        tableHtml = `<table class="export-table"><thead><tr>${headers}</tr></thead><tbody>${rows}</tbody></table>`;
                    }

                    if (txsForPage.length === 0 && !includeSummary) {
                        tableHtml = `<p style="text-align:center; padding: 20px;">${langForExport === 'en' ? '(No transactions for this page)' : '(      )'}</p>`;
                    } else if (txsForPage.length === 0 && includeSummary) {
                        tableHtml = '';
                    }

                    let summaryHtml = '';
                    if (includeSummary && fullReportTotals) {
                        summaryHtml = `<div class="export-summary"><h3 class="export-summary-title">${langForExport === 'en' ? 'Summary' : ''}</h3><div class="export-summary-row"><span class="export-summary-label">${langForExport === 'en' ? 'Total In' : ' '}:</span><span class="export-summary-value in-amount">Rs ${fullReportTotals.recTotal.toFixed(2)}</span></div><div class="export-summary-row"><span class="export-summary-label">${langForExport === 'en' ? 'Total Out' : ' '}:</span><span class="export-summary-value out-amount">Rs ${fullReportTotals.senTotal.toFixed(2)}</span></div><div class="export-summary-row net-balance-row"><span class="export-summary-label">${langForExport === 'en' ? 'Net Balance' : ' '}:</span><span class="export-summary-value">Rs ${fullReportTotals.netBal.toFixed(2)}</span></div></div>`;
                    }

                    let footerHTML = `<div class="export-footer-item"><strong>${langForExport === 'en' ? 'Generated on' : '  '}:</strong> ${new Date().toLocaleString(langForExport === 'en' ? 'en-US' : 'ur-PK')}</div>`;
                    if (currentOrgNameForExport) footerHTML += `<div class="export-footer-item"><strong>${langForExport === 'en' ? 'Organization' : ''}:</strong> ${currentOrgNameForExport}</div>`;
                    if (currentPersonalNameForExport) footerHTML += `<div class="export-footer-item"><strong>${langForExport === 'en' ? 'Prepared by' : ' '}:</strong> ${currentPersonalNameForExport}</div>`;

                    const pageIndicatorHtml = totalPages > 1 ? `<div class="export-page-number">${langForExport === 'en' ? 'Page' : ''} ${pageNum} / ${totalPages}</div>` : '';

                    el.innerHTML = `<div class="export-header"><h1 class="export-title">${currentOrgNameForExport || (langForExport === 'en' ? 'My Organization' : ' ')}</h1><h2 class="export-subtitle">${periodTitle}</h2></div>${pageIndicatorHtml}${tableHtml}${summaryHtml}<div class="export-footer">${footerHTML}</div>`;
                    document.body.appendChild(el);

                    const generateCanvas = () => {
                        html2canvas(el, {
                                scale: window.devicePixelRatio || 2,
                                useCORS: true,
                                logging: false,
                                width: el.offsetWidth,
                                height: el.offsetHeight,
                                windowWidth: el.scrollWidth,
                                windowHeight: el.scrollHeight,
                                removeContainer: false
                            })
                            .then(canvas => {
                                if (document.body.contains(el)) document.body.removeChild(el);
                                const sanitizedOrgName = (currentOrgNameForExport || 'Report').replace(/[^a-zA-Z0-9_ \-]/g, '_').slice(0, 30).trim() || 'Report';
                                const fileName = `${sanitizedOrgName}_${exportFileNamePrefix}_Report_Page${pageNum}_${new Date().toISOString().slice(0,10)}.png`;

                                canvas.toBlob(blob => {
                                    if (!blob) {
                                        rejectPromise(new Error('Failed to create blob from canvas.'));
                                        return;
                                    }
                                    const blobUrl = URL.createObjectURL(blob);
                                    resolvePromise({
                                        imageUrl: blobUrl,
                                        fileName: fileName,
                                        originalBlob: blob
                                    });
                                }, 'image/png');
                            }).catch(err => {
                                console.error("html2canvas error:", err);
                                if (document.body.contains(el)) document.body.removeChild(el);
                                rejectPromise(err);
                            });
                    };
                    requestAnimationFrame(() => {
                        setTimeout(generateCanvas, 400);
                    });
                });
            }, []);

            const handleShareImage = async(reportPagesDataArray) => {
                if (isOffline) {
                    showNotification(language === 'en' ? 'Sharing requires an internet connection.' : '      ', 'info');
                    return;
                }
                if (!window.cordova || !window.plugins || !window.plugins.socialsharing || !window.cordova.file) {
                    showNotification(language === 'en' ? 'Sharing feature not available.' : '    ', 'error');
                    console.warn("Cordova SocialSharing or File plugin not found.");
                    return;
                }
                if (!reportPagesDataArray || reportPagesDataArray.length === 0) {
                    showNotification(language === 'en' ? 'No report pages to share.' : '       ', 'error');
                    return;
                }

                setIsProcessing(true);
                showNotification(language === 'en' ? 'Preparing images for sharing...' : '        ...', 'info', null);

                try {
                    const filePaths = [];
                    const directory = cordova.file.cacheDirectory || cordova.file.externalDataDirectory || cordova.file.dataDirectory;
                    if (!directory) throw new Error("No suitable directory for saving temporary files.");

                    for (let i = 0; i < reportPagesDataArray.length; i++) {
                        const pageData = reportPagesDataArray[i];
                        let imageBlob;

                        if (pageData.originalBlob instanceof Blob) {
                            imageBlob = pageData.originalBlob;
                        } else if (typeof pageData.imageUrl === 'string' && pageData.imageUrl.startsWith('blob:')) {
                            const response = await fetch(pageData.imageUrl);
                            imageBlob = await response.blob();
                        } else {
                            console.warn(`Invalid image data for page ${i + 1}, skipping.`);
                            continue;
                        }

                        const filePath = await new Promise((resolve, reject) => {
                            window.resolveLocalFileSystemURL(directory, (dirEntry) => {
                                dirEntry.getFile(pageData.fileName, {
                                    create: true,
                                    exclusive: false
                                }, (fileEntry) => {
                                    fileEntry.createWriter((fileWriter) => {
                                        fileWriter.onwriteend = () => resolve(fileEntry.toURL());
                                        fileWriter.onerror = (e) => reject(new Error(`File writer error for ${pageData.fileName}: ${JSON.stringify(e)}`));
                                        fileWriter.write(imageBlob);
                                    }, (err) => reject(new Error(`Create writer error for ${pageData.fileName}: ${JSON.stringify(err)}`)));
                                }, (err) => reject(new Error(`Get file error for ${pageData.fileName}: ${JSON.stringify(err)}`)));
                            }, (err) => reject(new Error(`Resolve directory error: ${JSON.stringify(err)}`)));
                        });
                        filePaths.push(filePath);
                    }

                    if (filePaths.length === 0) {
                        throw new Error("No valid images were prepared for sharing.");
                    }

                    window.plugins.socialsharing.shareWithOptions({
                            message: language === 'en' ? `Spend Wise Report` : `  `,
                            subject: language === 'en' ? 'Financial Report' : ' ',
                            files: filePaths,
                        },
                        (result) => {
                            console.log("Share completed: " + result.completed + " - " + result.app);
                            showNotification(result.completed ? (language === 'en' ? 'Report shared!' : '  !') : (language === 'en' ? 'Sharing cancelled.' : '   '), result.completed ? 'success' : 'info');
                            filePaths.forEach(fp => window.resolveLocalFileSystemURL(fp, fe => fe.remove(() => {}, () => {}), () => {}));
                            setMessage(null);
                            setIsProcessing(false);
                        },
                        (error) => {
                            console.error("Sharing failed: " + error);
                            showNotification(language === 'en' ? 'Sharing failed.' : '  ', 'error');
                            filePaths.forEach(fp => window.resolveLocalFileSystemURL(fp, fe => fe.remove(() => {}, () => {}), () => {}));
                            setMessage(null);
                            setIsProcessing(false);
                        });

                } catch (error) {
                    console.error("Error in handleShareImage:", error);
                    showNotification(language === 'en' ? 'Error preparing images for sharing.' : '       ', 'error');
                    setMessage(null);
                    setIsProcessing(false);
                }
            };


            const exportTransactionsAndShowPreview = async(period) => {
                let txToExport = [...transactions].sort((a, b) => a.timestamp - b.timestamp);
                const now = new Date();
                let periodTitle = '',
                    exportFileNamePrefix = '';
                if (period === 'week') {
                    txToExport = txToExport.filter(t => new Date(t.timestamp) >= new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000));
                    periodTitle = language === 'en' ? 'Weekly Report' : '  ';
                    exportFileNamePrefix = 'Weekly';
                } else if (period === 'month') {
                    txToExport = txToExport.filter(t => new Date(t.timestamp) >= new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()));
                    periodTitle = language === 'en' ? 'Monthly Report' : ' ';
                    exportFileNamePrefix = 'Monthly';
                } else {
                    periodTitle = language === 'en' ? 'Full Report' : ' ';
                    exportFileNamePrefix = 'Full';
                }

                if (txToExport.length === 0) {
                    showNotification(language === 'en' ? `No transactions for this period.` : `       `, 'info');
                    return;
                }

                setIsProcessing(true);
                showNotification(language === 'en' ? `Generating ${periodTitle.toLowerCase()}...` : `${periodTitle.toLowerCase()}     ...`, 'info', null);

                const itemsPerPage = 8;
                let totalPages = Math.ceil(txToExport.length / itemsPerPage);
                const generatedPagesData = [];

                const fullReportRecTotal = txToExport.filter(t => t.type === 'receive').reduce((s, t) => s + t.amount, 0);
                const fullReportSenTotal = txToExport.filter(t => t.type === 'send').reduce((s, t) => s + Math.abs(t.amount), 0);
                const fullReportNetBal = fullReportRecTotal - fullReportSenTotal;
                const fullReportTotals = {
                    recTotal: fullReportRecTotal,
                    senTotal: fullReportSenTotal,
                    netBal: fullReportNetBal
                };

                const needsExtraSummaryPage = (txToExport.length % itemsPerPage === 0 && txToExport.length > 0);
                if (needsExtraSummaryPage) {
                    totalPages += 1;
                }

                try {
                    for (let i = 0; i < totalPages; i++) {
                        const isLastPage = (i === totalPages - 1);
                        const isSummaryOnlyPage = isLastPage && needsExtraSummaryPage;
                        const pageTransactions = isSummaryOnlyPage ? [] : txToExport.slice(i * itemsPerPage, (i + 1) * itemsPerPage);

                        const pageData = await generateReportImageData(
                            pageTransactions,
                            periodTitle,
                            organizationName,
                            personalName,
                            language,
                            exportFileNamePrefix,
                            i + 1,
                            totalPages,
                            isLastPage,
                            fullReportTotals
                        );
                        generatedPagesData.push(pageData);
                    }

                    if (generatedPagesData.length > 0) {
                        setReportImagePages(generatedPagesData);
                        setCurrentPage('imagePreview');
                    } else {
                        showNotification(language === 'en' ? 'Failed to generate report pages.' : '    ', 'error');
                    }
                } catch (err) {
                    console.error(`Error during ${period} report generation:`, err);
                    showNotification(language === 'en' ? 'Failed to generate report preview.' : '     ', 'error');
                } finally {
                    setIsProcessing(false);
                    setMessage(null);
                }
            };

            const toggleTheme = () => {
                setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
            };
            const toggleDropdown = () => setDropdownOpen(!dropdownOpen);
            const selectLanguage = (langCode, showNotif = true) => {
                setLanguage(langCode);
                setDropdownOpen(false);
                setIsLanguageModalOpen(false);
                if (showNotif) {
                    showNotification(langCode === 'en' ? 'Switched to English' : '    ', 'info');
                }
            };

            const currentLanguageData = languages.find(lang => lang.code === language) || languages[0];
            const handleAmountChange = (e) => {
                setAmount(e.target.value);
            };
            const handleDescriptionChange = (e) => {
                setDescription(e.target.value);
            };

            const handleDismissWelcomeMessage = () => {
                setShowWelcomeMessage(false);
                localStorage.setItem('welcomeMessageShown_v7', 'true');
            };

            const handleSideMenuNavigation = (target) => {
                if (target === 'userManual') {
                    setShowUserManualModal(true);
                } else if (target === 'privacyPolicy') {
                    setIsPrivacyPolicyOpen(true);
                } else if (target === 'language') {
                    setIsLanguageModalOpen(true);
                } else {
                    setCurrentPage(target);
                }
                setIsSideMenuOpen(false);
            };

            let pageToRender;

            if (!initialLanguageChosen) {
                pageToRender = React.createElement(InitialLanguageScreen, {
                    onSelect: handleInitialLanguageSelect
                });
            } else if (showOfflinePageOnStartup) {
                pageToRender = React.createElement(OfflinePage, {
                    language: language
                });
            } else if (!initialSetupDoneRef.current) {
                pageToRender = React.createElement(OrganizationSetupScreen, {
                    onSave: handleSaveInitialSetup,
                    language: language,
                    showNotification: showNotification
                });
            } else if (currentPage === 'profile') {
                pageToRender = React.createElement(ProfilePage, {
                    language: language,
                    onBack: () => setCurrentPage('main'),
                    initialPersonalName: personalName,
                    initialOrgName: organizationName,
                    onSaveProfile: handleSaveProfile,
                    showNotification: showNotification
                });
            } else if (currentPage === 'transactions') {
                pageToRender = React.createElement(TransactionsPage, {
                    transactions: transactions,
                    language: language,
                    onBack: () => setCurrentPage('main'),
                    onDeleteConfirm: confirmDeleteTransaction,
                    onEditTransaction: openEditModal,
                    organizationName: organizationName,
                    onDeleteAllConfirm: confirmDeleteAllTransactions
                });
            } else if (currentPage === 'imagePreview') {
                pageToRender = React.createElement(ImagePreviewPage, {
                    language: language,
                    onBack: () => setCurrentPage('main'),
                    imagePagesData: reportImagePages,
                    onImageShare: handleShareImage,
                    showNotification: showNotification
                });
            } else {
                pageToRender = React.createElement(Fragment, null,
                    React.createElement('div', {
                            className: "container"
                        },
                        React.createElement('header', null,
                            React.createElement('div', {
                                    className: "header-left-cluster"
                                },
                                React.createElement('button', {
                                    className: "header-icon-btn hamburger-menu-btn",
                                    onClick: () => setIsSideMenuOpen(true),
                                    "aria-label": language === 'en' ? "Open menu" : " ",
                                    title: language === 'en' ? "Open menu" : " ",
                                    disabled: !canInteractWithApp
                                }, React.createElement(IconMenu, null))
                            ),
                            React.createElement('div', {
                                    className: "header-title-area"
                                },
                                React.createElement('h1', null, "SPEND WISE"),
                                React.createElement('p', {
                                    className: "app-subtitle"
                                }, language === 'en' ? 'Expense Manager' : '  '),
                                canInteractWithApp && organizationName.trim() &&
                                React.createElement('span', {
                                    className: "header-org-name-display",
                                    title: organizationName
                                }, organizationName)
                            ),
                            React.createElement('div', {
                                className: "header-placeholder-right"
                            })
                        ),
                        React.createElement('div', {
                                className: "form-scrollable-area"
                            },
                            React.createElement('div', {
                                    className: "language-selector"
                                },
                                React.createElement('div', {
                                        className: `language-toggle ${dropdownOpen ? 'open' : ''}`,
                                        onClick: !canInteractWithApp ? null : toggleDropdown,
                                        "aria-expanded": dropdownOpen,
                                        "aria-haspopup": "listbox",
                                        disabled: !canInteractWithApp,
                                        style: !canInteractWithApp ? {
                                            opacity: 0.6,
                                            cursor: 'not-allowed'
                                        } : {}
                                    },
                                    React.createElement('div', {
                                            style: {
                                                display: 'flex',
                                                alignItems: 'center'
                                            }
                                        },
                                        React.createElement('img', {
                                            src: currentLanguageData.flag,
                                            alt: currentLanguageData.name,
                                            className: "language-flag"
                                        }),
                                        currentLanguageData.name
                                    ),
                                    React.createElement(IconChevronDown, {
                                        className: "language-toggle-icon"
                                    })
                                ),
                                dropdownOpen && React.createElement('div', {
                                        className: "language-dropdown",
                                        role: "listbox"
                                    },
                                    languages.map((lang) => React.createElement('div', {
                                            key: lang.code,
                                            role: "option",
                                            "aria-selected": language === lang.code,
                                            className: `language-option ${language === lang.code ? 'active' : ''}`,
                                            onClick: () => selectLanguage(lang.code)
                                        },
                                        React.createElement('img', {
                                            src: lang.flag,
                                            alt: lang.name,
                                            className: "language-flag"
                                        }), lang.name)))
                            ),
                            React.createElement('div', {
                                    className: "balance-container"
                                },
                                React.createElement('div', {
                                    className: "balance-box received"
                                }, React.createElement('strong', null, language === 'en' ? 'In' : ''), React.createElement('div', {
                                    className: "amount-value"
                                }, "Rs ", canInteractWithApp ? receivedTotal.toFixed(2) : '0.00')),
                                React.createElement('div', {
                                    className: "balance-box sent"
                                }, React.createElement('strong', null, language === 'en' ? 'Out' : ''), React.createElement('div', {
                                    className: "amount-value"
                                }, "Rs ", canInteractWithApp ? Math.abs(sentTotal).toFixed(2) : '0.00')),
                                React.createElement('div', {
                                    className: "balance-box balance"
                                }, React.createElement('strong', null, language === 'en' ? 'Balance' : ''), React.createElement('div', {
                                    className: "amount-value"
                                }, "Rs ", canInteractWithApp ? netBalance.toFixed(2) : '0.00'))
                            ),
                            React.createElement('div', {
                                    className: "transaction-type"
                                },
                                React.createElement('button', {
                                    className: `receive-btn ${transactionType === 'receive' ? 'active' : ''}`,
                                    onClick: () => setTransactionType('receive'),
                                    disabled: !canInteractWithApp
                                }, language === 'en' ? 'In' : ''),
                                React.createElement('button', {
                                    className: `send-btn ${transactionType === 'send' ? 'active' : ''}`,
                                    onClick: () => setTransactionType('send'),
                                    disabled: !canInteractWithApp
                                }, language === 'en' ? 'Out' : '')
                            ),
                            React.createElement('input', {
                                type: "number",
                                placeholder: language === 'en' ? 'Amount (e.g., 500)' : ' ( )',
                                value: amount,
                                onChange: handleAmountChange,
                                inputMode: "decimal",
                                disabled: !canInteractWithApp
                            }),
                            React.createElement('div', {
                                    className: `input-group ${language === 'ur' ? 'rtl-layout' : ''}`
                                },
                                React.createElement('input', {
                                    type: "text",
                                    placeholder: language === 'en' ? 'Details (e.g., Groceries, Utility Bill)' : ' (   )',
                                    value: description,
                                    onChange: handleDescriptionChange,
                                    style: {
                                        direction: language === 'ur' ? 'rtl' : 'ltr'
                                    },
                                    disabled: !canInteractWithApp
                                }),
                                React.createElement('button', {
                                    className: `voice-btn ${isListening ? 'listening' : ''}`,
                                    onClick: startVoiceInput,
                                    "aria-label": language === 'en' ? 'Voice input for details' : '     ',
                                    title: language === 'en' ? 'Tap to speak' : '    ',
                                    disabled: !canInteractWithApp || isListening || isOffline
                                }, React.createElement(IconMicrophone, null))
                            ),
                            React.createElement('button', {
                                    onClick: addTransaction,
                                    disabled: !canInteractWithApp || isListening || isProcessing
                                },
                                isProcessing && currentPage === 'main' ? React.createElement('span', {
                                    className: "button-spinner"
                                }) : (language === 'en' ? 'Add Transaction' : '   ')
                            ),
                            React.createElement('button', {
                                    className: "view-transactions-btn",
                                    onClick: () => setCurrentPage('transactions'),
                                    disabled: !canInteractWithApp || transactions.length === 0
                                },
                                language === 'en' ? 'View Transactions' : '  ', " (", canInteractWithApp ? transactions.length : 0, ")"
                            ),
                            React.createElement('div', {
                                    className: "export-options"
                                },
                                React.createElement('button', {
                                    onClick: () => exportTransactionsAndShowPreview('week'),
                                    disabled: !canInteractWithApp || transactions.length === 0 || isProcessing
                                }, language === 'en' ? 'Weekly (Image)' : '  ()'),
                                React.createElement('button', {
                                    onClick: () => exportTransactionsAndShowPreview('month'),
                                    disabled: !canInteractWithApp || transactions.length === 0 || isProcessing
                                }, language === 'en' ? 'Monthly (Image)' : ' ()'),
                                React.createElement('button', {
                                    onClick: () => exportTransactionsAndShowPreview('all'),
                                    disabled: !canInteractWithApp || transactions.length === 0 || isProcessing
                                }, language === 'en' ? 'Full (Image)' : ' ()')
                            )
                        )
                    ),
                    canInteractWithApp && React.createElement('button', {
                        className: "fab-calculator",
                        onClick: () => setIsCalculatorOpen(true),
                        "aria-label": language === 'en' ? "Open calculator" : " "
                    }, React.createElement(IconCalculator, null))
                );
            }

            return React.createElement('div', {
                    className: "content-wrapper"
                },
                message && React.createElement('div', {
                        className: "message-container",
                        "aria-live": "polite",
                        "aria-atomic": "true"
                    },
                    React.createElement(Message, {
                        text: message.text,
                        type: message.type,
                        onClose: () => setMessage(null),
                        language: language
                    })
                ),
                showWelcomeMessage && initialSetupDoneRef.current && !showOfflinePageOnStartup &&
                React.createElement(WelcomeOverlay, {
                    language: language,
                    onDismiss: handleDismissWelcomeMessage
                }),

                React.createElement(VoicePermissionPreDialog, {
                    isOpen: showVoicePermPreDialog,
                    onAllow: handleVoicePermPreDialogAllow,
                    onDeny: handleVoicePermPreDialogDeny,
                    language: language
                }),

                React.createElement(CalculatorModal, {
                    isOpen: isCalculatorOpen,
                    onClose: () => setIsCalculatorOpen(false),
                    language: language
                }),

                canInteractWithApp && React.createElement(SideMenu, {
                    isOpen: isSideMenuOpen,
                    onClose: () => setIsSideMenuOpen(false),
                    language: language,
                    onNavigate: handleSideMenuNavigation,
                    onToggleTheme: toggleTheme,
                    currentTheme: theme
                }),

                React.createElement(UserManualModal, {
                    isOpen: showUserManualModal,
                    onClose: () => setShowUserManualModal(false),
                    language: language
                }),

                React.createElement(PrivacyPolicyModal, {
                    isOpen: isPrivacyPolicyOpen,
                    onClose: () => setIsPrivacyPolicyOpen(false),
                    language: language
                }),

                React.createElement(LanguageSelectionModal, {
                    isOpen: isLanguageModalOpen,
                    onClose: () => setIsLanguageModalOpen(false),
                    onSelect: selectLanguage,
                    languages: languages
                }),

                React.createElement('div', {
                        className: "page-container",
                        key: currentPage + (initialSetupDoneRef.current ? organizationName : 'no-org-setup') + (reportImagePages.length > 0 ? reportImagePages[0].imageUrl : '') + (showOfflinePageOnStartup ? 'offline-startup' : 'online-startup') + initialLanguageChosen
                    },
                    pageToRender
                ),
                React.createElement(Modal, {
                        isOpen: isDeleteModalOpen,
                        onClose: () => {
                            setIsDeleteModalOpen(false);
                            setTransactionToDelete(null);
                        },
                        title: language === 'en' ? "Confirm Deletion" : "    ",
                        onConfirm: executeDeleteTransaction,
                        language: language,
                        confirmText: language === 'en' ? "Delete" : " ",
                        confirmButtonClass: "confirm-btn"
                    },
                    React.createElement('p', null, language === 'en' ? "Are you sure you want to delete this transaction?" : "          "),
                    transactionToDelete && React.createElement('p', {
                            style: {
                                fontSize: '0.8em',
                                color: 'var(--modal-text-color)',
                                wordBreak: 'break-all'
                            }
                        },
                        React.createElement('em', null, transactionToDelete.description, " - Rs ", Math.abs(transactionToDelete.amount).toFixed(2))
                    )
                ),
                React.createElement(Modal, {
                        isOpen: isDeleteAllModalOpen,
                        onClose: () => setIsDeleteAllModalOpen(false),
                        title: language === 'en' ? "Confirm Delete All" : "     ",
                        onConfirm: executeDeleteAllTransactions,
                        language: language,
                        confirmText: language === 'en' ? "Delete All" : "  ",
                        confirmButtonClass: "confirm-btn"
                    },
                    React.createElement('p', null, language === 'en' ? "Are you sure you want to delete ALL transactions? This action cannot be undone." : "                ")
                ),
                React.createElement(Modal, {
                        isOpen: isEditModalOpen,
                        onClose: () => {
                            setIsEditModalOpen(false);
                            setTransactionToEdit(null);
                        },
                        title: language === 'en' ? "Edit Transaction" : "    ",
                        language: language,
                        customActions: React.createElement(Fragment, null)
                    },
                    React.createElement(EditTransactionForm, {
                        transaction: transactionToEdit,
                        onSave: handleSaveEditedTransaction,
                        onCancel: () => {
                            setIsEditModalOpen(false);
                            setTransactionToEdit(null);
                        },
                        language: language,
                        showNotification: showNotification
                    })
                )
            );
        }

        // --- GLOBAL CORDOVA INITIALIZATION & REACT APP RENDERING ---
        function hideLoader() {
            const loader = document.getElementById('loader');
            if (loader) {
                loader.classList.add('hidden');
            }
        }

        function renderReactApplication() {
            console.log("Global: Attempting to render React application...");
            try {
                const rootElement = document.getElementById('root');
                if (!rootElement) {
                    console.error("Global: CRITICAL - Root element (#root) not found in DOM.");
                    document.body.innerHTML = '<div style="color:red; padding:20px; text-align:center;">Error: App container not found. Check console.</div>';
                    return;
                }
                ReactDOM.createRoot(rootElement).render(React.createElement(App));
                console.log("Global: React application render initiated.");
            } catch (error) {
                console.error("Global: CRITICAL ERROR during React render initiation:", error);
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    rootElement.innerHTML = `<div style="color:red; padding:20px; text-align:center;">Critical error initializing app: ${error.message}. Check console for details.</div>`;
                }
            }
        }

        window.actualDeviceIsReady = false;

        function onGlobalDeviceReady() {
            console.log("Global: 'deviceready' event HAS FIRED.");
            window.actualDeviceIsReady = true;

            if (window.StatusBar) {
                StatusBar.overlaysWebView(false);
                console.log("Global: StatusBar settings applied.");
            } else {
                console.warn("Global: StatusBar plugin not found at deviceready.");
            }

            hideLoader();
            renderReactApplication();
        }

        console.log("Global: Script execution started. Checking for Cordova...");
        if (window.cordova) {
            console.log("Global: Cordova environment detected. Adding 'deviceready' listener.");
            document.addEventListener('deviceready', onGlobalDeviceReady, false);
        } else {
            console.warn("Global: Cordova NOT detected. Initializing for browser/fallback.");
            const init = () => {
                hideLoader();
                renderReactApplication();
            };
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                init();
            } else {
                document.addEventListener('DOMContentLoaded', init);
            }
        }
    </script>
</body>

</html>